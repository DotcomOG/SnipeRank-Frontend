<!DOCTYPE html>
<html lang="en">
<head>
  <!-- analyze.html — v4.4.1 (Oct 27, 2025)
       - Fix: Full report form POSTs to Render (/api/send-link) then redirects to /full-report.html?url=...
       - Keeps existing UI/logic; no scoring or layout changes
  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SnipeRank — AI SEO Analysis</title>
  <style>
    :root{
      --max: 820px; --muted:#6b7280; --border:#e5e7eb; --black:#0f172a;
      --accent:#2563eb; --accent-dark:#1d4ed8; --pill:#f8fafc; --bg:#ffffff;
      --danger:#dc2626;
      --btn-red:#dc3545; --btn-red-hover:#c82333;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;color:var(--black);background:var(--bg);}
    .wrap{max-width:var(--max);margin:40px auto;padding:0 20px}
    h1{font-size:40px;line-height:1.1;margin:0 0 8px;background:linear-gradient(135deg,#000 0%,#3182CE 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .sub{color:var(--muted);margin:2px 0 22px}
    .card{border:1px solid var(--border);border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:16px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between}
    .pill{background:var(--pill);border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-weight:600}
    .btn{background:var(--accent);color:#fff;border:0;border-radius:999px;padding:10px 16px;font-weight:700;cursor:pointer}
    .btn:hover{background:var(--accent-dark)}
    .btn-danger{background:var(--danger)}
    .section{margin-top:22px}
    .muted{color:var(--muted)}
    ul{margin:8px 0 0 18px}
    li{margin:6px 0;line-height:1.6}
    .spinner{width:16px;height:16px;border:2px solid #ddd;border-top-color:#666;border-radius:50%;display:inline-block;animation:spin 1s linear infinite;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    .err{color:#b91c1c}

    /* Form */
    .form-section{text-align:center;padding:24px 16px;border-top:1px solid var(--border);margin-top:22px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:0 auto 10px}
    .form-full{grid-column:1/-1}
    .form-section input, .form-section textarea{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:8px;font-size:15px;font-family:inherit}
    .form-section textarea{min-height:90px;resize:vertical}
    .form-btn{margin-top:8px;max-width:260px;background:var(--btn-red);border-radius:999px;color:#fff;border:0;padding:10px 18px;font-weight:700;cursor:pointer}
    .form-btn:hover{background:var(--btn-red-hover)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>SnipeRank</h1>
    <div class="sub">AI SEO Analysis • Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>

    <div class="card">
      <div class="row">
        <div>
          <div class="muted">Analyzing</div>
          <div id="target-url" style="font-weight:800">—</div>
        </div>
        <div class="pill" id="score-pill">Scoring…</div>
        <div style="display:flex;gap:8px">
          <button id="fullBtn" class="btn" type="button" title="Open the comprehensive report">View Full Report</button>
        </div>
      </div>
    </div>

    <div class="section" id="quick-report">
      <p class="muted"><span class="spinner"></span> Running quick analysis…</p>
    </div>

    <!-- Get Full Report Form (email capture + redirect) -->
    <section class="form-section">
      <h3>Get Your Full Report</h3>
      <form id="full-report-form">
        <div class="form-grid">
          <input type="text" id="name-input" placeholder="Your Name" required />
          <input type="email" id="email-input" placeholder="Your Email" required />
          <input type="tel" id="phone-input" placeholder="Your Phone (optional)" />
          <input type="text" id="company-input" placeholder="Your Company (optional)" />
          <textarea class="form-full" id="context-input" placeholder="Share context or ask a specific question — we'll address it in your free consult."></textarea>
        </div>
        <button type="submit" class="form-btn">Get My Full Report</button>
      </form>
    </section>

    <div class="section">
      <a class="btn btn-danger" href="https://calendly.com/quontora" target="_blank" rel="noopener">Schedule Strategy Session</a>
    </div>
  </div>

  <script>
    // === Backend base for form submission ===
    const API_BASE = "https://sniperank-v2-dev.onrender.com";

    // URL param
    const qs = new URLSearchParams(location.search);
    const targetUrl = qs.get("url") || "";

    const urlEl   = document.getElementById("target-url");
    const pillEl  = document.getElementById("score-pill");
    const quickEl = document.getElementById("quick-report");
    const fullBtn = document.getElementById("fullBtn");

    urlEl.textContent = targetUrl || "—";

    // Button path to full report
    fullBtn.addEventListener("click", () => {
      if (!targetUrl){
        alert("No URL detected. Please start from the homepage and enter a website to analyze.");
        return;
      }
      window.location.href = `/full-report.html?url=${encodeURIComponent(targetUrl)}`;
    });

    // Lightweight quick analysis (visual only)
    (function runQuickAnalysis(){
      if (!targetUrl){
        quickEl.innerHTML = `<p class="err">No URL provided.</p>`;
        pillEl.textContent = "—";
        fullBtn.disabled = true;
        return;
      }
      const seed = Array.from(targetUrl).reduce((a,c)=>a+c.charCodeAt(0),0);
      const score = 40 + (seed % 21); // 40..60 visual
      pillEl.textContent = `${score}/100`;

      const points = [
        "Homepage loads with valid HTML structure.",
        "Titles and headings are present; consider clarifying primary intent.",
        "Add structured data (Organization, WebSite) for richer AI understanding.",
        "Ensure prominent CTAs exist above the fold.",
        "Add descriptive alt text to key images.",
        "Create an FAQ section aligned to real user tasks.",
        "Add internal links between related pages to guide crawlers.",
        "Publish a short ‘What we do’ summary in plain language."
      ];
      quickEl.innerHTML = `
        <h3>Quick Takeaways</h3>
        <ul>${points.map(p=>`<li>${p}</li>`).join("")}</ul>
        <p class="muted" style="margin-top:10px">For a comprehensive, client-ready report with prioritized actions and AI-engine insights, click <b>View Full Report</b> above.</p>
      `;
    })();

    // === Fix 404: form submission to Render + redirect ===
    document.getElementById('full-report-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name-input').value.trim();
      const email = document.getElementById('email-input').value.trim();
      const phone = document.getElementById('phone-input').value.trim();
      const company = document.getElementById('company-input').value.trim();
      const context = document.getElementById('context-input').value.trim();

      if (!name || !email || !targetUrl){
        alert("Name, email, and a valid URL are required.");
        return;
      }

      // Fire-and-forget to Render
      try{
        await fetch(`${API_BASE}/api/send-link`, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ name, email, phone, company, context, url: targetUrl })
        });
      }catch(err){
        // Do not block the user from getting the report if the email capture fails
        console.warn('send-link failed (continuing to full report):', err);
      }

      // Redirect to full report either way
      window.location.href = `/full-report.html?url=${encodeURIComponent(targetUrl)}`;
    });
  </script>
</body>
</html>
