<!DOCTYPE html>
<html lang="en">
<head>
  <!-- analyze.html ‚Äî v3.8.0 (Free Quick Analysis)
       - Dots animation in lightbox
       - 5 working items, 10 improvement items
       - Enhanced loading experience
       Last updated: Oct 30, 2025
  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SnipeRank ‚Äî AI SEO Quick Analysis (Free)</title>
  <style>
    :root{
      --max-width:960px; --pad-v:3vh; --pad-h:2rem;
      --muted:#6b7280; --border:#e5e7eb; --text:#0f172a; --bg:#fff;
      --btn:#dc3545; --btn-hover:#c82333;
      --chip:#f8fafc; --chip-border:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;
      background:#fff;color:var(--text);margin:0;
      padding:var(--pad-v) var(--pad-h);max-width:var(--max-width);margin-inline:auto;
    }
    h1{font-size:3rem;margin:0 0 .25em;line-height:1;letter-spacing:-.5px}
    h1 span{color:#3182CE}
    h2{margin:.25rem 0 2rem;color:#111;font-size:1.25rem;font-weight:800}
    .row{display:flex;align-items:center;justify-content:space-between;margin:.25rem 0 1rem;color:var(--muted);font-size:.95rem}
    .row strong{color:#000}

    .card{border:1px solid var(--border);border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .score-card{padding:16px 18px;margin:0 0 28px;position:relative;overflow:hidden}
    .score-top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .score-num{display:flex;align-items:baseline;gap:10px}
    .score{font-size:2.5rem;font-weight:900}
    .band{color:var(--muted);font-weight:600}
    .pillars{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
    .chip{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;border:1px solid var(--chip-border);background:var(--chip);font-weight:700}
    .chip span:last-child{font-weight:800}
    .btns{display:flex;gap:8px;margin-top:12px}
    .btn{border:1px solid #111;background:#fff;color:#111;padding:.55rem .9rem;border-radius:8px;cursor:pointer;font-weight:700;font-size:.95rem}
    .btn:hover{background:#f3f4f6}

    /* Sections */
    .section{margin:24px 0}
    .section h3{font-size:1.15rem;margin:0 0 .75rem}
    ul.klist{margin:.25rem 0 0 1.1rem;padding:0}
    ul.klist li{margin:.45rem 0;line-height:1.6}
    .hidden{display:none}

    /* CTA + form */
    .cta-card{padding:18px;margin:28px 0;border:1px solid #e0e7ff;background:#f8f9ff;border-radius:12px;text-align:center}
    .cta-card p{margin:.25rem 0 1rem;color:#4338ca}
    .cta-actions{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}
    .cta-primary,.cta-secondary{
      border:none;border-radius:999px;padding:.85rem 1.25rem;font-weight:800;color:#fff;background:var(--btn);cursor:pointer;text-decoration:none;
      display:inline-block;
    }
    .cta-primary:hover,.cta-secondary:hover{background:var(--btn-hover)}

    /* --- Loading animation (score shimmer) --- */
    .score-card.loading{
      animation:pulse-shimmer 2s ease-in-out infinite;
    }
    .score-card.loading::before{
      content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.45),transparent);
      animation:shimmer 2s ease-in-out infinite;
    }
    @keyframes pulse-shimmer{
      0%,100%{box-shadow:0 1px 2px rgba(0,0,0,.04)}
      50%{box-shadow:0 6px 26px rgba(49,130,206,.22)}
    }
    @keyframes shimmer{0%{left:-100%}100%{left:100%}}

    /* Blocking Lightbox */
    .overlay{position:fixed;inset:0;background:rgba(255,255,255,.96);display:flex;align-items:center;justify-content:center;z-index:1000}
    .panel{width:min(520px,92vw);background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.12);padding:22px 20px;position:relative;overflow:hidden}
    .panel.loading{animation:pulse-shimmer 2s ease-in-out infinite}
    .panel.loading::before{
      content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.55),transparent);
      animation:shimmer 2s ease-in-out infinite;
    }
    .p-title{font-weight:900;font-size:18px;margin:0 0 10px}
    .p-sub{color:#6b7280;font-size:14px;margin:0 0 12px}
    .bar{height:12px;border-radius:8px;background:#eee;overflow:hidden;margin:12px 0}
    .fill{height:100%;border-radius:8px;background:linear-gradient(90deg,#3182CE,#1a73e8);width:0%}
    .p-eta{color:#6b7280;font-size:14px}
    .timeout{display:none;margin-top:14px;border-top:1px dashed #e5e7eb;padding-top:12px}
    .timeout strong{color:#111}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .ghost{border:1px solid #111;background:#fff;color:#111;padding:.6rem 1rem;border-radius:10px;font-weight:800;cursor:pointer}
    .primary{border:none;background:var(--btn);color:#fff;padding:.6rem 1rem;border-radius:999px;font-weight:800;cursor:pointer}
    .primary:hover{background:var(--btn-hover)}

    /* Dots Animation */
    .dots{display:flex;align-items:center;justify-content:center;gap:8px;margin:16px 0}
    .dot{width:12px;height:12px;border-radius:50%;background:#3182CE;animation:dot-bounce 1.4s ease-in-out infinite both}
    .dot:nth-child(1){animation-delay:-0.32s}
    .dot:nth-child(2){animation-delay:-0.16s}
    .dot:nth-child(3){animation-delay:0s}
    @keyframes dot-bounce{
      0%,80%,100%{transform:scale(0.8);opacity:0.5}
      40%{transform:scale(1.2);opacity:1}
    }

    .footer{color:#6b7280;font-size:.9rem;margin:36px 0 8px;text-align:center}
  </style>
</head>
<body>
  <h1>Snipe<span>Rank</span></h1>
  <h2>AI SEO Quick Analysis (Free)</h2>

  <div class="row">
    <div>Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>
    <div>Analysis for: <strong id="current-url">‚Äî</strong></div>
  </div>

  <!-- SCORE CARD -->
  <section class="card score-card loading" id="scoreCard" aria-live="polite">
    <div class="score-top">
      <div class="score-num">
        <div class="score" id="scoreNumber">‚Äî</div>
        <div class="band" id="scoreBand">Analyzing‚Ä¶</div>
      </div>
      <div class="btns">
        <button class="btn" id="breakdownBtn" type="button">What goes into this score?</button>
        <button class="btn" id="copyBtn" type="button" disabled>Copy Shareable Summary</button>
      </div>
    </div>
    <div class="pillars" id="pillarsGrid">
      <div class="chip"><span>AI Access Readiness</span><span>‚Äî/25</span></div>
      <div class="chip"><span>Trust & Verification Signals</span><span>‚Äî/25</span></div>
      <div class="chip"><span>LLM Interpretability & Clarity</span><span>‚Äî/25</span></div>
      <div class="chip"><span>Prompt-Pattern Alignment</span><span>‚Äî/25</span></div>
    </div>
  </section>

  <!-- WORKING / ISSUES (remain hidden until real data arrives) -->
  <section class="section hidden" id="workingSection">
    <h3>What's Working Well</h3>
    <ul id="workingList" class="klist"></ul>
  </section>

  <section class="section hidden" id="issuesSection">
    <h3>Where You Can Improve</h3>
    <ul id="issuesList" class="klist"></ul>
  </section>

  <!-- CTA -->
  <div class="cta-card">
    <h3 style="margin:.25rem 0 .5rem">Want the Full Breakdown & Step-by-Step Fixes?</h3>
    <p>Get your detailed 50-page AI SEO report and a free 30-minute consultation.</p>
    <div class="cta-actions">
      <a class="cta-primary" href="#report-form">Get My Full Report (Free)</a>
      <a class="cta-secondary" href="https://calendly.com/quontora" target="_blank" rel="noopener">Book Consultation</a>
    </div>
  </div>

  <!-- FORM -->
  <section id="report-form" class="section card" style="padding:18px">
    <h3>Get Your Detailed Report</h3>
    <form id="full-report-form" novalidate>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <input type="text" id="name-input" placeholder="Your Name" required style="padding:10px;border:1px solid var(--border);border-radius:8px"/>
        <input type="email" id="email-input" placeholder="Your Email" required style="padding:10px;border:1px solid var(--border);border-radius:8px"/>
        <input type="tel" id="phone-input" placeholder="Your Phone (optional)" style="padding:10px;border:1px solid var(--border);border-radius:8px"/>
        <input type="text" id="company-input" placeholder="Your Company (optional)" style="padding:10px;border:1px solid var(--border);border-radius:8px"/>
        <textarea id="context-input" placeholder="Share context or ask a specific question ‚Äî we'll address it in your consult." style="grid-column:1/-1;min-height:90px;padding:10px;border:1px solid var(--border);border-radius:8px"></textarea>
      </div>
      <div id="form-error" style="color:#c00;margin-top:8px;display:none"></div>
      <button id="full-report-btn" type="submit" class="cta-primary" style="margin-top:12px">Get My Full Report</button>
    </form>
  </section>

  <!-- SCORE BREAKDOWN MODAL -->
  <div class="overlay hidden" id="breakdown">
    <div class="panel">
      <div class="p-title">What goes into your SnipeRank score?</div>
      <div class="p-sub">
        <p><strong>üéØ AI Access Readiness (25)</strong> ‚Äî crawlability, speed, mobile, indexability.</p>
        <p><strong>üîí Trust & Verification Signals (25)</strong> ‚Äî authorship, citations, security, authority cues.</p>
        <p><strong>üìù LLM Interpretability & Clarity (25)</strong> ‚Äî headings, schema, semantic structure.</p>
        <p><strong>üîç Prompt-Pattern Alignment (25)</strong> ‚Äî FAQs, Q&A blocks, task/intent coverage.</p>
      </div>
      <div class="actions" style="justify-content:flex-end">
        <button class="ghost" id="closeBreakdown" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- BLOCKING LIGHTBOX (loading + timeout) -->
  <div class="overlay" id="progress">
    <div class="panel loading" id="progressPanel">
      <div class="p-title">Analyzing your website‚Ä¶</div>
      <div class="p-sub">Checking structure, AI visibility signals, and content clarity.</div>
      
      <!-- Dots Animation -->
      <div class="dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      
      <div class="bar"><div class="fill" id="pFill"></div></div>
      <div class="p-eta" id="pEta">This usually takes 15‚Äì45 seconds.</div>

      <div class="timeout" id="timeoutBox">
        <p><strong>Still working‚Ä¶</strong> Large or protected sites can take longer. You can keep waiting, retry now, or get the full report by email.</p>
        <div class="actions">
          <button class="ghost" id="keepWaitingBtn" type="button">Keep Waiting</button>
          <button class="ghost" id="retryBtn" type="button">Retry Now</button>
          <a class="primary" href="#report-form">Get Full Report</a>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">¬© 2025 SnipeRank by <a href="https://quontora.com" target="_blank" rel="noopener">quontora.com</a></div>

  <script>
    /* ---------- Setup ---------- */
    const $ = id => document.getElementById(id);
    const urlParams = new URLSearchParams(window.location.search);
    const targetUrl = urlParams.get('url') || '';
    $("current-url").textContent = targetUrl || '‚Äî';

    const LOGOS = {
      ChatGPT: '/img/chatgpt-logo.png',
      Claude: '/img/claude.jpeg',
      Gemini: '/img/gemini.jpeg',
      Copilot: '/img/copilot.jpeg',
      Perplexity: '/img/perplexity-logo.png',
    };
    Object.values(LOGOS).forEach(src => { const i=new Image(); i.src=src; });

    function extractDomain(u){
      if (!u) return '';
      try{ return new URL(/^https?:\/\//i.test(u)?u:`https://${u}`).hostname.replace(/^www\./,''); }
      catch{ const m=String(u).match(/^(?:https?:\/\/)?([^\/?#]+)/i); return (m?m[1]:'').replace(/^www\./,''); }
    }

    /* ---------- UI helpers ---------- */
    function renderScore(total, pillars){
      $("scoreNumber").textContent = `${Math.round(total)}/100`;
      $("scoreBand").textContent =
        total >= 70 ? "Rank: Highly Visible ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ" :
        total >= 55 ? "Rank: Partially Visible ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ" :
        total >= 40 ? "Rank: Needs Work ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ" : "Rank: Low Visibility ‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ";

      const items = [
        ["AI Access Readiness", pillars.access ?? 0],
        ["Trust & Verification Signals", pillars.trust ?? 0],
        ["LLM Interpretability & Clarity", pillars.clarity ?? 0],
        ["Prompt-Pattern Alignment", pillars.alignment ?? 0]
      ];
      $("pillarsGrid").innerHTML = items.map(([label,val]) =>
        `<div class="chip"><span>${label}</span><span>${val}/25</span></div>`).join("");

      $("scoreCard").classList.remove("loading");
      $("copyBtn").disabled = false;
    }

    function setList(el, arr, maxItems){
      if (!arr || !arr.length) return;
      const items = arr.slice(0, maxItems);
      el.innerHTML = items.map(x => `<li>${x}</li>`).join("");
    }

    /* ---------- Modal controls ---------- */
    $("breakdownBtn").addEventListener('click', ()=> $("breakdown").classList.remove('hidden'));
    $("closeBreakdown").addEventListener('click', ()=> $("breakdown").classList.add('hidden'));
    $("breakdown").addEventListener('click', (e)=>{ if(e.target===$("breakdown")) $("breakdown").classList.add('hidden'); });

    /* ---------- Copy summary ---------- */
    $("copyBtn").addEventListener("click", async () => {
      const scoreText = $("scoreNumber").textContent || "-/100";
      const labels = [...document.querySelectorAll('.chip span:first-child')].map(el => el.textContent.trim());
      const vals = [...document.querySelectorAll('.chip span:last-child')].map(el => el.textContent.trim());
      const working = [...$("workingList").querySelectorAll('li')].map(li=>li.textContent.trim());
      const issues = [...$("issuesList").querySelectorAll('li')].map(li=>li.textContent.trim());
      const txt = [
        `Website: ${targetUrl}`,
        `SnipeRank Score: ${scoreText}`,
        ``,
        `Pillars:`,
        ...labels.map((l,i)=>`- ${l}: ${vals[i]||''}`),
        working.length?``,`Top strengths:`,...working.map(x=>`- ${x}`):[],
        issues.length?``,`Top issues:`,...issues.map(x=>`- ${x}`):[],
        ``,
        `Get the full report at: ${window.location.origin}/full-report.html`
      ].flat().join("\n");
      try{
        await navigator.clipboard.writeText(txt);
        const b = $("copyBtn"); const t=b.textContent; b.textContent="Copied!"; setTimeout(()=>b.textContent=t,1200);
      }catch{ window.prompt("Copy the summary:", txt); }
    });

    /* ---------- Form ---------- */
    $("full-report-form").addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = $("name-input").value.trim();
      const email = $("email-input").value.trim();
      const phone = $("phone-input").value.trim();
      const company = $("company-input").value.trim();
      const context = $("context-input").value.trim();
      const err = $("form-error");
      if(!name || !email || !targetUrl){
        err.textContent = "Please provide your name and email."; err.style.display='block'; return;
      }
      err.style.display='none';
      const domain = extractDomain(targetUrl);
      sessionStorage.setItem('sniperank:name', name);
      sessionStorage.setItem('sniperank:email', email);
      sessionStorage.setItem('sniperank:phone', phone);
      sessionStorage.setItem('sniperank:company', company);
      sessionStorage.setItem('sniperank:context', context);
      sessionStorage.setItem('sniperank:url', targetUrl);
      sessionStorage.setItem('sniperank:domain', domain);
      $("full-report-btn").disabled = true;
      $("full-report-btn").textContent = "Preparing Full Report‚Ä¶";
      const q = new URLSearchParams({ url: targetUrl, name: encodeURIComponent(name), email: encodeURIComponent(email), domain, source:'analyze' }).toString();
      window.location.href = `full-report.html?${q}`;
    });

    /* ---------- Blocking overlay progress + timeout ---------- */
    const PROBE_TIMEOUT_MS = 8000;
    const TIMEOUT_MS = 25000;
    let progressTimer, timeoutTimer;

    function startProgress(){
      const fill = $("pFill");
      let pct = 0;
      progressTimer = setInterval(()=>{
        pct = Math.min(pct + Math.random()*3, 90);
        fill.style.width = pct + '%';
      }, 120);
    }
    function completeProgress(){
      clearInterval(progressTimer);
      $("pFill").style.transition='width .5s ease';
      $("pFill").style.width='100%';
      setTimeout(()=> $("progress").classList.add('hidden'), 500);
    }
    function showTimeout(){
      $("progressPanel").classList.remove('loading');
      $("timeoutBox").style.display = 'block';
      $("pEta").textContent = "The server is taking longer than usual.";
    }
    function resetOverlayForRetry(){
      $("timeoutBox").style.display='none';
      $("progressPanel").classList.add('loading');
      $("pFill").style.width='0%';
      startProgress();
      startTimeouts();
    }
    function startTimeouts(){
      clearTimeout(timeoutTimer);
      timeoutTimer = setTimeout(showTimeout, TIMEOUT_MS);
    }

    $("retryBtn").addEventListener('click', ()=> { resetOverlayForRetry(); loadAll(true); });
    $("keepWaitingBtn").addEventListener('click', ()=> { startTimeouts(); });

    /* ---------- Data loading ---------- */
    function parseFirstULAfterHeading(html, headingRegex){
      const tmp = document.createElement('div'); 
      tmp.innerHTML = html;
      const nodes = [...tmp.querySelectorAll('h1,h2,h3,h4,.section-title,strong')];
      const hit = nodes.find(n => headingRegex.test((n.textContent||'').trim()));
      if(!hit) return [];
      let p = hit.nextElementSibling;
      while(p && (!p.tagName || p.tagName.toLowerCase()!=='ul')) p = p.nextElementSibling;
      if(!p) return [];
      return [...p.querySelectorAll('li')].map(li => (li.textContent||'').trim()).filter(Boolean);
    }

    async function decideApiBase(){
      try{
        const ctl = new AbortController();
        const t = setTimeout(()=>ctl.abort(), PROBE_TIMEOUT_MS);
        const probe = await fetch('/api/score?url=' + encodeURIComponent('https://example.com'), {signal:ctl.signal});
        clearTimeout(t);
        if (!probe.ok) throw new Error(`Local API returned ${probe.status}`);
        console.log('‚úÖ Local API working');
        return '';
      }catch(e){ 
        console.log('üîÑ Using fallback server:', e.message);
        return 'https://sniperank-app2.onrender.com'; 
      }
    }

    async function loadAll(isRetry=false){
      if (!targetUrl) { 
        console.error('‚ùå No target URL provided');
        showTimeout(); 
        return; 
      }

      console.log('üîç Analyzing:', targetUrl);
      const apiBase = await decideApiBase();

      // SCORE
      try{
        const scoreUrl = `${apiBase}/api/score?url=${encodeURIComponent(targetUrl)}`;
        console.log('üìä Fetching score...');
        const r = await fetch(scoreUrl, {headers:{'Accept':'application/json'}});
        
        if (!r.ok) throw new Error(`Score API: ${r.status}`);
        
        const j = await r.json();
        console.log('‚úÖ Score loaded:', j.score);
        
        renderScore(Number(j.score ?? 0), j.pillars ?? {access:0,trust:0,clarity:0,alignment:0});
      }catch(e){
        console.error('‚ùå Score failed:', e.message);
        $("scoreBand").textContent = "Unable to load score";
        $("scoreCard").classList.remove("loading");
      }

      // REPORT
      try{
        const reportUrl = `${apiBase}/report.html?report=analyze&url=${encodeURIComponent(targetUrl)}`;
        console.log('üìù Fetching report...');
        const res = await fetch(reportUrl, {headers:{'Accept':'text/html'}});
        
        if (!res.ok) throw new Error(`Report API: ${res.status}`);
        
        const html = await res.text();
        console.log('‚úÖ Report loaded');
        
        const working = parseFirstULAfterHeading(html, /working\s+well/i);
        const issues = parseFirstULAfterHeading(html, /(improve|issues?|opportunities)/i);
        
        console.log(`üìà Found ${working.length} strengths, ${issues.length} issues`);

        // Exactly 5 working items, 10 issues
        if (working.length){ 
          setList($("workingList"), working, 5); 
          $("workingSection").classList.remove('hidden'); 
        }
        if (issues.length){ 
          setList($("issuesList"), issues, 10); 
          $("issuesSection").classList.remove('hidden'); 
        }
      }catch(e){
        console.error('‚ùå Report failed:', e.message);
      }

      completeProgress();
    }

    // Start
    (function init(){
      console.log('üöÄ Starting SnipeRank...');
      startProgress();
      startTimeouts();
      loadAll(false);
    })();
  </script>
</body>
</html>
