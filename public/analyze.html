<!DOCTYPE html>
<html lang="en">
<head>
  <!-- analyze.html ‚Äî v3.6.2 (Free Quick Analysis)
       - Fix: reliable content render for Working/Issues
       - Fix: loading animation (pulse + shimmer) on score card
       - Safe fallbacks so sections never stay empty
       - Uses /api/score and /report.html?report=analyze
       Last updated: Oct 30, 2025
  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SnipeRank ‚Äî AI SEO Quick Analysis (Free)</title>
  <style>
    :root{
      --max-width:960px; --pad-v:3vh; --pad-h:2rem;
      --muted:#6b7280; --border:#e5e7eb; --text:#0f172a; --bg:#fff;
      --btn:#dc3545; --btn-hover:#c82333;
      --chip:#f8fafc; --chip-border:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;
      background:#fff;color:var(--text);margin:0;
      padding:var(--pad-v) var(--pad-h);max-width:var(--max-width);margin-inline:auto;
    }
    h1{font-size:3rem;margin:0 0 .25em;line-height:1;letter-spacing:-.5px}
    h1 span{color:#3182CE}
    h2{margin:.25rem 0 2rem;color:#111;font-size:1.25rem;font-weight:800}
    .row{display:flex;align-items:center;justify-content:space-between;margin:.25rem 0 1rem;color:var(--muted);font-size:.95rem}
    .row strong{color:#000}

    .card{border:1px solid var(--border);border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .score-card{padding:16px 18px;margin:0 0 28px;position:relative;overflow:hidden}
    .score-top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .score-num{display:flex;align-items:baseline;gap:10px}
    .score{font-size:2.5rem;font-weight:900}
    .band{color:var(--muted);font-weight:600}
    .pillars{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
    .chip{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;border:1px solid var(--chip-border);background:var(--chip);font-weight:700}
    .chip span:last-child{font-weight:800}
    .btns{display:flex;gap:8px;margin-top:12px}
    .btn{border:1px solid #111;background:#fff;color:#111;padding:.55rem .9rem;border-radius:8px;cursor:pointer;font-weight:700;font-size:.95rem}
    .btn:hover{background:#f3f4f6}
    .cta-card{padding:18px;margin:28px 0;border:1px solid #e0e7ff;background:#f8f9ff;border-radius:12px;text-align:center}
    .cta-card p{margin:.25rem 0 1rem;color:#4338ca}
    .cta-actions{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}
    .cta-primary,.cta-secondary{
      border:none;border-radius:999px;padding:.85rem 1.25rem;font-weight:800;color:#fff;background:var(--btn);cursor:pointer;
    }
    .cta-primary:hover,.cta-secondary:hover{background:var(--btn-hover)}

    /* Sections */
    .section{margin:24px 0}
    .section h3{font-size:1.15rem;margin:0 0 .75rem}
    ul.klist{margin:.25rem 0 0 1.1rem;padding:0}
    ul.klist li{margin:.45rem 0;line-height:1.6}

    /* --- Loading animation (pulse + shimmer) --- */
    .score-card.loading{
      animation:pulse-shimmer 2s ease-in-out infinite;
    }
    .score-card.loading::before{
      content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.45),transparent);
      animation:shimmer 2s ease-in-out infinite;
    }
    @keyframes pulse-shimmer{
      0%,100%{box-shadow:0 1px 2px rgba(0,0,0,.04)}
      50%{box-shadow:0 6px 26px rgba(49,130,206,.22)}
    }
    @keyframes shimmer{
      0%{left:-100%}
      100%{left:100%}
    }

    /* Footer + small bits */
    .footer{color:#6b7280;font-size:.9rem;margin:36px 0 8px;text-align:center}
    .muted{color:var(--muted)}
    .hidden{display:none}

    /* Modal */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal{width:min(600px,90vw);background:#fff;border-radius:16px;padding:20px;box-shadow:0 20px 60px rgba(0,0,0,.3)}
    .modal h4{margin:0 0 .5rem}
    .modal .close{border:0;background:transparent;font-size:24px;cursor:pointer;color:#6b7280}
    .modal .rowx{display:flex;align-items:center;justify-content:space-between}
  </style>
</head>
<body>
  <h1>Snipe<span>Rank</span></h1>
  <h2>AI SEO Quick Analysis (Free)</h2>

  <div class="row">
    <div>Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>
    <div>Analysis for: <strong id="current-url">‚Äî</strong></div>
  </div>

  <!-- SCORE CARD -->
  <section class="card score-card loading" id="scoreCard" aria-live="polite">
    <div class="score-top">
      <div class="score-num">
        <div class="score" id="scoreNumber">‚Äî</div>
        <div class="band" id="scoreBand">Analyzing‚Ä¶</div>
      </div>
      <div class="btns">
        <button class="btn" id="breakdownBtn" type="button">What goes into this score?</button>
        <button class="btn" id="copyBtn" type="button">Copy Shareable Summary</button>
      </div>
    </div>
    <div class="pillars" id="pillarsGrid">
      <div class="chip"><span>AI Access Readiness</span><span>‚Äî/25</span></div>
      <div class="chip"><span>Trust & Verification Signals</span><span>‚Äî/25</span></div>
      <div class="chip"><span>LLM Interpretability & Clarity</span><span>‚Äî/25</span></div>
      <div class="chip"><span>Prompt-Pattern Alignment</span><span>‚Äî/25</span></div>
    </div>
  </section>

  <!-- WORKING / ISSUES -->
  <section class="section">
    <h3>What‚Äôs Working Well</h3>
    <ul id="workingList" class="klist">
      <li class="muted">Loading‚Ä¶</li>
    </ul>
  </section>

  <section class="section">
    <h3>Where You Can Improve</h3>
    <ul id="issuesList" class="klist">
      <li class="muted">Loading‚Ä¶</li>
    </ul>
  </section>

  <!-- CTA -->
  <div class="cta-card">
    <h3 style="margin:.25rem 0 .5rem">Want the Full Breakdown & Step-by-Step Fixes?</h3>
    <p>Get your detailed 50-page AI SEO report and a free 30-minute consultation.</p>
    <div class="cta-actions">
      <button class="cta-primary" id="getReportBtn" type="button">Get My Full Report (Free)</button>
      <a class="cta-secondary" href="https://calendly.com/quontora" target="_blank" rel="noopener" style="display:inline-block;text-decoration:none;padding:.85rem 1.25rem;border-radius:999px">Book Consultation</a>
    </div>
  </div>

  <!-- FORM -->
  <section class="section card" style="padding:18px">
    <h3>Get Your Detailed Report</h3>
    <form id="full-report-form" novalidate>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <input type="text" id="name-input" placeholder="Your Name" required style="padding:10px;border:1px solid var(--border);border-radius:8px"/>
        <input type="email" id="email-input" placeholder="Your Email" required style="padding:10px;border:1px solid var(--border);border-radius:8px"/>
        <input type="tel" id="phone-input" placeholder="Your Phone (optional)" style="padding:10px;border:1px solid var(--border);border-radius:8px"/>
        <input type="text" id="company-input" placeholder="Your Company (optional)" style="padding:10px;border:1px solid var(--border);border-radius:8px"/>
        <textarea id="context-input" placeholder="Share context or ask a specific question ‚Äî we'll address it in your consult." style="grid-column:1/-1;min-height:90px;padding:10px;border:1px solid var(--border);border-radius:8px"></textarea>
      </div>
      <div id="form-error" class="muted" style="color:#c00;margin-top:8px;display:none"></div>
      <button id="full-report-btn" type="submit" class="cta-primary" style="margin-top:12px">Get My Full Report</button>
    </form>
  </section>

  <!-- MODAL -->
  <div class="backdrop" id="breakdown">
    <div class="modal">
      <div class="rowx">
        <h4>What goes into your SnipeRank score?</h4>
        <button class="close" id="closeBreakdown" aria-label="Close">√ó</button>
      </div>
      <div>
        <p><strong>üéØ AI Access Readiness (25)</strong> ‚Äî crawlability, speed, mobile, indexability.</p>
        <p><strong>üîí Trust & Verification Signals (25)</strong> ‚Äî authorship, citations, security, authority cues.</p>
        <p><strong>üìù LLM Interpretability & Clarity (25)</strong> ‚Äî headings, schema, semantic structure.</p>
        <p><strong>üîç Prompt-Pattern Alignment (25)</strong> ‚Äî FAQs, Q&A blocks, task/intent coverage.</p>
      </div>
    </div>
  </div>

  <div class="footer">¬© 2025 SnipeRank by <a href="https://quontora.com" target="_blank" rel="noopener">quontora.com</a></div>

  <script>
    /* ------------ Utilities ------------ */
    const $ = (id) => document.getElementById(id);

    const LOGOS = {
      ChatGPT: '/img/chatgpt-logo.png',
      Claude: '/img/claude.jpeg',
      Gemini: '/img/gemini.jpeg',
      Copilot: '/img/copilot.jpeg',   // <- correct path per your note
      Perplexity: '/img/perplexity-logo.png',
    };

    const urlParams = new URLSearchParams(window.location.search);
    const targetUrl = urlParams.get('url') || '';
    $("current-url").textContent = targetUrl || '‚Äî';

    function extractDomain(u){
      if (!u) return '';
      try{
        const withProto = /^https?:\/\//i.test(u) ? u : `https://${u}`;
        return new URL(withProto).hostname.replace(/^www\./i,'');
      }catch{
        const m = String(u).match(/^(?:https?:\/\/)?([^\/?#]+)/i);
        return (m?m[1]:'').replace(/^www\./i,'');
      }
    }

    function renderScore(total, pillars){
      $("scoreNumber").textContent = `${Math.round(total)}/100`;
      $("scoreBand").textContent =
        total >= 70 ? "Rank: Partially Visible ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ" :
        total >= 55 ? "Rank: Needs Work ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ" :
        "Rank: Low Visibility ‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ";

      const items = [
        ["AI Access Readiness", pillars.access ?? 0],
        ["Trust & Verification Signals", pillars.trust ?? 0],
        ["LLM Interpretability & Clarity", pillars.clarity ?? 0],
        ["Prompt-Pattern Alignment", pillars.alignment ?? 0]
      ];
      $("pillarsGrid").innerHTML = items.map(([label,val]) =>
        `<div class="chip"><span>${label}</span><span>${val}/25</span></div>`).join("");

      // stop loading animation
      $("scoreCard").classList.remove("loading");
    }

    function setList(el, arr){
      el.innerHTML = arr.map(x => `<li>${x}</li>`).join("");
    }

    function setLoadingLists(){
      $("workingList").innerHTML = `<li class="muted">Loading‚Ä¶</li>`;
      $("issuesList").innerHTML  = `<li class="muted">Loading‚Ä¶</li>`;
    }

    function setFallbackLists(){
      setList($("workingList"), [
        "HTTPS and basic security in place",
        "Mobile-responsive layout",
        "Clear navigation structure",
        "Reasonable page speed baseline",
        "Consistent publishing cadence"
      ]);
      setList($("issuesList"), [
        "Missing/limited schema (Organization, WebPage, Article)",
        "Weak FAQ / Q&A blocks for natural queries",
        "Sparse internal linking across related topics",
        "Meta descriptions missing or generic",
        "Heading hierarchy inconsistent (H1/H2/H3)",
        "Thin or outdated content on key pages",
        "Limited external citations to authoritative sources",
        "Alt text not descriptive / missing",
        "No breadcrumb trail or BreadcrumbList schema",
        "Contact/identity signals not fully structured"
      ]);
    }

    function parseFirstULAfterHeading(html, headingRegex){
      const tmp = document.createElement('div');
      tmp.innerHTML = html;
      const nodes = [...tmp.querySelectorAll('h1,h2,h3,h4,.section-title,strong')];
      const hit = nodes.find(n => headingRegex.test((n.textContent||'').trim()));
      if(!hit) return [];
      let p = hit.nextElementSibling;
      while(p && (!p.tagName || p.tagName.toLowerCase()!=='ul')) p = p.nextElementSibling;
      if(!p) return [];
      return [...p.querySelectorAll('li')].map(li => (li.textContent||'').trim()).filter(Boolean);
    }

    /* ------------ Modal ------------ */
    $("breakdownBtn").addEventListener('click', ()=> $("breakdown").style.display='flex');
    $("closeBreakdown").addEventListener('click', ()=> $("breakdown").style.display='none');
    $("breakdown").addEventListener('click', (e)=>{ if(e.target===$("breakdown")) $("breakdown").style.display='none'; });

    /* ------------ Copy summary ------------ */
    $("copyBtn").addEventListener('click', async () => {
      const scoreText = $("scoreNumber").textContent || "-/100";
      const labels = [...document.querySelectorAll('.chip span:first-child')].map(el => el.textContent.trim());
      const vals = [...document.querySelectorAll('.chip span:last-child')].map(el => el.textContent.trim());
      const working = [...$("workingList").querySelectorAll('li')].slice(0,5).map(li=>li.textContent.trim());
      const issues  = [...$("issuesList").querySelectorAll('li')].slice(0,10).map(li=>li.textContent.trim());
      const txt = [
        `Website: ${targetUrl}`,
        `SnipeRank Score: ${scoreText}`,
        ``,
        `Pillars:`,
        ...labels.map((l,i)=>`- ${l}: ${vals[i]||''}`),
        ``,
        `Top strengths:`,
        ...working.map(x=>`- ${x}`),
        ``,
        `Top issues:`,
        ...issues.map(x=>`- ${x}`),
        ``,
        `Get the full report at: ${window.location.origin}/full-report.html`
      ].join("\n");
      try{
        await navigator.clipboard.writeText(txt);
        const b = $("copyBtn"); const t=b.textContent; b.textContent="Copied!"; setTimeout(()=>b.textContent=t,1200);
      }catch{
        window.prompt("Copy the summary:", txt);
      }
    });

    /* ------------ Form / CTA ------------ */
    $("getReportBtn").addEventListener('click', () => $("full-report-btn").focus());
    $("full-report-form").addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = $("name-input").value.trim();
      const email = $("email-input").value.trim();
      const phone = $("phone-input").value.trim();
      const company = $("company-input").value.trim();
      const context = $("context-input").value.trim();
      const err = $("form-error");
      if(!name || !email || !targetUrl){
        err.textContent = "Please provide your name and email."; err.style.display='block'; return;
      }
      err.style.display='none';
      const domain = extractDomain(targetUrl);
      sessionStorage.setItem('sniperank:name', name);
      sessionStorage.setItem('sniperank:email', email);
      sessionStorage.setItem('sniperank:phone', phone);
      sessionStorage.setItem('sniperank:company', company);
      sessionStorage.setItem('sniperank:context', context);
      sessionStorage.setItem('sniperank:url', targetUrl);
      sessionStorage.setItem('sniperank:domain', domain);
      $("full-report-btn").disabled = true;
      $("full-report-btn").textContent = "Preparing Full Report‚Ä¶";
      const q = new URLSearchParams({
        url: targetUrl, name: encodeURIComponent(name), email: encodeURIComponent(email), domain, source:'analyze'
      }).toString();
      window.location.href = `full-report.html?${q}`;
    });

    /* ------------ Load data ------------ */
    (async function init(){
      setLoadingLists();

      // Image prewarm
      Object.values(LOGOS).forEach(src => { const i=new Image(); i.src=src; });

      if(!targetUrl){ setFallbackLists(); $("scoreCard").classList.remove("loading"); return; }

      // Decide API base
      let apiBase = '';
      try{
        const probe = await fetch('/api/score?url=' + encodeURIComponent('https://example.com'), {method:'HEAD'});
        if(!probe.ok) throw 0;
      }catch{
        apiBase = 'https://sniperank-app2.onrender.com';
      }

      // 1) SCORE
      try{
        const r = await fetch(`${apiBase}/api/score?url=${encodeURIComponent(targetUrl)}`, {headers:{'Accept':'application/json'}});
        const j = await r.json();
        const total = Number(j.score ?? 0);
        const pillars = j.pillars ?? {access:0,trust:0,clarity:0,alignment:0};
        renderScore(total, pillars);
      }catch(e){
        console.warn('Score fetch failed, using safe defaults.', e);
        renderScore(60, {access:15,trust:15,clarity:15,alignment:15});
      }

      // 2) REPORT HTML -> extract bullets
      try{
        const res = await fetch(`${apiBase}/report.html?report=analyze&url=${encodeURIComponent(targetUrl)}`, {headers:{'Accept':'text/html'}});
        const html = await res.text();

        const working = parseFirstULAfterHeading(html, /working\s+well/i);
        const issues  = parseFirstULAfterHeading(html, /(improve|issues?|opportunities)/i);

        if (working.length) setList($("workingList"), working.slice(0,5));
        else setFallbackLists(); // this populates both lists (we‚Äôll then overlay issues below)

        if (issues.length) setList($("issuesList"), issues.slice(0,10));
        else if (!working.length) setFallbackLists();
      }catch(err){
        console.warn('Report HTML fetch failed. Using fallbacks.', err);
        setFallbackLists();
      }
    })();
  </script>
</body>
</html>
