<!DOCTYPE html>
<!--
  SnipeRank Analyze Page
  Version: v4.0.0-launch-ready
  Release Date: November 18, 2025
  Last Modified: November 18, 2025
  
  INTERNAL RELEASE NOTES:
  - Complete UI redesign with circular progress wheel
  - Implemented clear CTA hierarchy (premium gradient vs simple secondary)
  - Added consistent purple/blue gradient brand colors throughout
  - Form validation with mandatory fields marked with asterisks
  - Phone number now required for lead quality
  - Mobile-responsive design optimized for all devices
  - Fixed logo display issues for AI engines
  
  DEPLOYMENT STATUS: Ready for production
  TESTED ON: Chrome, Safari, Firefox, Mobile
  DEPENDENCIES: None (vanilla HTML/CSS/JS)
  
  CONFIDENTIAL DEVELOPMENT NOTES:
  - Pricing psychology: $35 anchor with "Launch Special" creates urgency
  - Form conversion optimized for B2B lead generation
  - Progress wheel designed to reduce bounce during analysis
  - CTA messaging focuses on value ($35 value) vs features
  
  NEXT PLANNED FEATURES:
  - A/B testing framework for form conversion
  - Integration with CRM for lead tracking
  - Advanced analytics for user behavior
  
  DO NOT REMOVE THESE COMMENTS - Used for version tracking and deployment
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SnipeRank - AI SEO Analysis</title>
  <style>
    :root{
      --max-width: 800px;
      --pad-v: 3vh;
      --pad-h: 2rem;
      --primary: #3182CE;
      --primary-dark: #2563EB;
      --text-dark: #000;
      --text-medium: #4a5568;
      --text-light: #718096;
      --border: #e2e8f0;
      --bg-light: #f7fafc;
      --btn-red: #dc3545;
      --btn-red-hover: #c82333;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: var(--text-dark);
      background: #f8fafc;
      max-width: var(--max-width);
      margin: 0 auto;
      padding: var(--pad-v) var(--pad-h);
    }

    h1 {
      font-size: 4rem;
      font-weight: 700;
      margin: 0 0 0.25em 0;
      line-height: 1;
      letter-spacing: -1px;
      background: linear-gradient(135deg, #000 0%, #3182CE 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      color: transparent;
      display: inline-block;
    }

    h2 {
      font-size: 1.25rem;
      color: var(--text-light);
      margin-bottom: 2rem;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      font-size: 0.9rem;
      color: #666;
    }

    .powered-by a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
    }

    .score-top {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .score-main {
      display: flex;
      align-items: baseline;
      gap: 0.75rem;
    }

    .score-number {
      font-size: 4rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      color: transparent;
    }

    .score-band {
      font-size: 1.25rem;
      color: #666;
    }

    .btn-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-medium);
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn-ghost:hover {
      background: var(--bg-light);
    }

    .pillars {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-bottom: 1.5rem;
    }

    .pillar {
      background: var(--bg-light);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .pillar .label {
      font-weight: 600;
      color: var(--text-dark);
      font-size: 0.95rem;
    }

    .badge {
      font-weight: 700;
      padding: 4px 12px;
      border-radius: 999px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: 1px solid rgba(102, 126, 234, 0.3);
      font-size: 0.9rem;
      color: white;
    }

    .highlights {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }

    .highlights h4 {
      margin: 0 0 1rem;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .highlights ul {
      margin: 0;
      padding-left: 1.2rem;
      list-style: disc;
    }

    .highlights li {
      margin: 0.5rem 0;
      line-height: 1.6;
      color: var(--text-medium);
    }

    #summary-results .section-title {
      font-size: 1.5rem !important;
      font-weight: 700 !important;
      margin: 2rem 0 1rem !important;
      color: var(--text-dark) !important;
    }

    #summary-results p {
      line-height: 1.7 !important;
      margin: 0 0 1rem !important;
      font-size: 1.05rem !important;
      color: var(--text-medium) !important;
    }

    .llm-insights {
      margin: 1.5rem 0;
    }

    .llm-row {
      display: flex;
      gap: 16px;
      align-items: flex-start;
      padding: 16px;
      background: var(--bg-light);
      border-radius: 12px;
      border-left: 4px solid var(--primary);
      margin-bottom: 12px;
    }

    .llm-logo {
      flex-shrink: 0;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      font-size: 12px;
      text-align: center;
    }

    .llm-logo.chatgpt { background: #10a37f; }
    .llm-logo.claude { background: #ff6b35; }
    .llm-logo.gemini { background: #4285f4; }
    .llm-logo.perplexity { background: #8b5cf6; }
    .llm-logo.copilot { background: #0078d4; }

    .llm-logo img {
      height: 28px;
      width: auto;
      object-fit: contain;
      border-radius: 4px;
    }

    .llm-fallback {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 28px;
      padding: 0 8px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      color: #333;
      background: #f8f9fa;
    }

    .llm-row p {
      flex: 1;
      margin: 0;
      color: var(--text-medium);
      font-size: 14px;
      line-height: 1.5;
    }

    /* PRIMARY CTA - Get Full Report */
    .premium-cta {
      text-align: center;
      padding: 3rem 2rem;
      margin-top: 3rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .premium-cta::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      border-radius: 20px;
    }

    .premium-cta * {
      position: relative;
      z-index: 1;
    }

    .launch-badge {
      display: inline-block;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 8px 20px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .premium-cta h3 {
      margin: 0 0 16px;
      font-size: 2.4rem;
      font-weight: 700;
      color: white;
    }

    .premium-cta .value-description {
      font-size: 1.2rem;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.95);
      margin: 0 0 2.5rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .premium-form {
      max-width: 500px;
      margin: 0 auto;
    }

    .premium-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .premium-full {
      grid-column: 1/-1;
    }

    .premium-cta input, 
    .premium-cta textarea {
      width: 100%;
      padding: 14px 18px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      font-size: 16px;
      font-family: inherit;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      backdrop-filter: blur(10px);
      transition: all 0.2s;
    }

    .premium-cta input::placeholder,
    .premium-cta textarea::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .premium-cta input:focus, 
    .premium-cta textarea:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.6);
      background: rgba(255, 255, 255, 0.15);
    }

    .premium-cta textarea {
      min-height: 100px;
      resize: vertical;
    }

    .premium-btn {
      background: white;
      color: #667eea;
      border: none;
      padding: 18px 40px;
      border-radius: 999px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-block;
      text-decoration: none;
      text-align: center;
      margin-top: 1.5rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .premium-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
      background: #f8f9fa;
    }

    .premium-features {
      margin-top: 2rem;
      display: flex;
      justify-content: center;
      gap: 32px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 600;
    }

    /* SECONDARY CTA - Consultation */
    .simple-cta {
      margin-top: 1.5rem;
      padding: 20px;
      background: var(--bg-light);
      border-radius: 12px;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }

    .simple-text h4 {
      margin: 0 0 4px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .simple-text p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--text-light);
    }

    .simple-btn {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
      padding: 10px 20px;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      white-space: nowrap;
    }

    .simple-btn:hover {
      background: var(--primary);
      color: white;
    }

    /* Circular Progress Overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .progress-panel {
      background: white;
      border-radius: 20px;
      padding: 48px 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      text-align: center;
      max-width: 500px;
      width: 90%;
    }

    .progress-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 16px;
    }

    .progress-subtitle {
      font-size: 16px;
      color: var(--text-light);
      margin-bottom: 32px;
      line-height: 1.5;
    }

    .progress-circle-container {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 0 auto 24px;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
      transform: rotate(-90deg);
    }

    .progress-circle-bg {
      fill: none;
      stroke: #e2e8f0;
      stroke-width: 8;
    }

    .progress-circle-fill {
      fill: none;
      stroke: url(#progressGradient);
      stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 0 283;
      transition: stroke-dasharray 0.3s ease;
    }

    .progress-percentage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }

    .progress-status {
      font-size: 16px;
      color: var(--text-medium);
      font-style: italic;
      margin-bottom: 16px;
      min-height: 20px;
    }

    .progress-eta {
      color: var(--text-medium);
      font-size: 14px;
      line-height: 1.4;
    }

    .progress-eta strong {
      color: var(--text-dark);
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1001;
    }

    .modal {
      width: min(600px, 90vw);
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      margin: 0;
      color: var(--text-dark);
    }

    .modal-close {
      background: transparent;
      border: 0;
      font-size: 24px;
      cursor: pointer;
      padding: 4px;
      color: #666;
      border-radius: 4px;
    }

    .modal-close:hover {
      color: var(--text-dark);
      background: var(--bg-light);
    }

    .modal-content {
      line-height: 1.6;
      color: var(--text-medium);
    }

    .modal-content p {
      margin: 12px 0;
    }

    .modal-content strong {
      color: var(--text-dark);
    }

    .footer {
      width: 100%;
      text-align: center;
      padding: 2rem 0 1rem;
      margin-top: 3rem;
      color: var(--text-light);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
    }

    .footer a {
      color: var(--primary);
      text-decoration: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 1.5rem 1rem;
      }

      h1 {
        font-size: 3rem;
      }

      .info-row {
        flex-direction: column;
        gap: 8px;
        text-align: center;
      }

      .btn-row {
        flex-direction: column;
        gap: 8px;
      }

      .btn-ghost {
        font-size: 12px;
        padding: 6px 12px;
        white-space: nowrap;
      }

      .pillars {
        grid-template-columns: 1fr;
      }

      .premium-grid {
        grid-template-columns: 1fr;
      }

      .premium-cta {
        padding: 2rem 1.5rem;
      }

      .premium-cta h3 {
        font-size: 2rem;
      }

      .premium-features {
        flex-direction: column;
        gap: 8px;
      }

      .simple-cta {
        flex-direction: column;
        text-align: center;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>SnipeRank</h1>
  <h2>AI Visibility Analysis</h2>

  <div class="info-row">
    <div class="powered-by">Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>
    <div class="for-url">Analysis for: <strong id="current-url">-</strong></div>
  </div>

  <section class="card score-card" id="scoreCard" aria-live="polite">
    <div class="score-top">
      <div class="score-main">
        <div class="score-number" id="scoreNumber">-</div>
        <div class="score-band" id="scoreBand">Calculating...</div>
      </div>
      <div class="btn-row">
        <button class="btn-ghost" id="breakdownBtn" type="button">What goes into this score?</button>
        <button class="btn-ghost" id="copyBtn" type="button">Copy Summary</button>
      </div>
    </div>
    <div class="pillars" id="pillarsGrid"></div>
    <div class="highlights" id="highlightsBlock" hidden>
      <h4>Highlights</h4>
      <ul id="highlightsList"></ul>
    </div>
  </section>

  <section id="summary-results">
    <p style="text-align:center;color:gray;">Loading analysis...</p>
  </section>

  <!-- PRIMARY CTA - Premium Report -->
  <section class="premium-cta">
    <div class="launch-badge">üöÄ Launch Special - Normally $35</div>
    <h3>Get Your Complete AI SEO Report</h3>
    <p class="value-description">Get the full 15-page analysis with detailed recommendations, competitive insights, and a step-by-step implementation roadmap. Includes a free 30-minute strategy consultation.</p>
    
    <div class="premium-form">
      <form id="full-report-form">
        <div class="premium-grid">
          <input type="text" id="name-input" placeholder="Your Name *" required />
          <input type="email" id="email-input" placeholder="Your Email *" required />
          <input type="tel" id="phone-input" placeholder="Your Phone *" required />
          <input type="text" id="company-input" placeholder="Your Company" />
          <textarea class="premium-full" id="context-input" placeholder="Share context or ask a specific question ‚Äî we'll address at your free consult."></textarea>
        </div>
        <button type="submit" class="premium-btn">Get My Free Report ($35 Value)</button>
        
        <div style="text-align: right; font-size: 7pt; color: rgba(255, 255, 255, 0.6); margin-top: 8px;">
          * designates that field as mandatory
        </div>
      </form>
    </div>
    
    <div class="premium-features">
      <span>‚úì 15-page analysis</span>
      <span>‚úì Implementation roadmap</span>
      <span>‚úì Free strategy call</span>
    </div>
  </section>

  <!-- SECONDARY CTA - Simple Consultation -->
  <section class="simple-cta">
    <div class="simple-text">
      <h4>Just want to chat first?</h4>
      <p>Book a quick call to discuss your AI SEO questions</p>
    </div>
    <a href="https://calendly.com/quontora" class="simple-btn" target="_blank" rel="noopener">Schedule Free Call</a>
  </section>

  <div class="footer">
    ¬© 2025 SnipeRank by <a href="https://quontora.com" target="_blank" rel="noopener">quontora.com</a>
  </div>

  <!-- Circular Progress Overlay -->
  <div id="progress-overlay" class="overlay">
    <div class="progress-panel">
      <h2 class="progress-title">Analyzing Your Website</h2>
      <p class="progress-subtitle">
        SnipeRank is performing a comprehensive AI SEO analysis of your site
      </p>
      
      <div class="progress-circle-container">
        <svg class="progress-circle" viewBox="0 0 120 120">
          <defs>
            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#a78bfa;stop-opacity:0.4" />
              <stop offset="100%" style="stop-color:#667eea;stop-opacity:1" />
            </linearGradient>
          </defs>
          <circle class="progress-circle-bg" cx="60" cy="60" r="45"></circle>
          <circle class="progress-circle-fill" id="progressCircle" cx="60" cy="60" r="45"></circle>
        </svg>
        <div class="progress-percentage" id="progressPercentage">0%</div>
      </div>
      
      <div class="progress-status" id="progressStatus">
        Initializing analysis...
      </div>
      
      <div class="progress-eta" id="progressEta">
        Performing comprehensive website analysis.<br>
        This typically takes <strong>15-45 seconds</strong>.
      </div>
    </div>
  </div>

  <!-- Score Breakdown Modal -->
  <div id="breakdown-modal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">What goes into your SnipeRank score?</h3>
        <button class="modal-close" id="modal-close">√ó</button>
      </div>
      <div class="modal-content">
        <p>Your SnipeRank score is calculated based on <strong>50+ SEO factors</strong> optimized for AI search engines.</p>
        
        <p><strong>üéØ AI Access Readiness (25 points)</strong><br>
        How easily AI systems can discover, crawl, and understand your site structure.</p>
        
        <p><strong>üîí Trust & Verification Signals (25 points)</strong><br>
        Authority indicators, security implementation, and credibility markers.</p>
        
        <p><strong>üìù LLM Interpretability & Clarity (25 points)</strong><br>
        Content organization, semantic markup, and clarity for AI language models.</p>
        
        <p><strong>üîç Prompt-Pattern Alignment (25 points)</strong><br>
        How well your content matches common search patterns and query structures.</p>
      </div>
    </div>
  </div>

  <script>
    const LOGO_SOURCES = {
      ChatGPT: '/img/chatgpt-logo.png',
      Claude: '/img/claude-logo.png', 
      Gemini: '/img/gemini-logo.png',
      Copilot: '/img/copilot-logo.png',
      Perplexity: '/img/perplexity-logo.png',
    };
    
    function logoDivFor(engine){
      const wrap = document.createElement('div'); 
      wrap.className = `llm-logo ${engine.toLowerCase()}`;
      
      const p = LOGO_SOURCES[engine];
      if (!p) {
        wrap.innerHTML = `<span class="llm-fallback">${engine}</span>`;
        return wrap;
      }
      
      const img = document.createElement('img'); 
      img.alt = `${engine} logo`; 
      img.src = p;
      img.onload = () => {
        wrap.innerHTML = ''; 
        wrap.appendChild(img);
      };
      img.onerror = () => {
        wrap.innerHTML = `<span class="llm-fallback">${getEngineIcon(engine)}</span>`;
      };
      
      return wrap;
    }
    
    function getEngineIcon(engine) {
      const icons = {
        'ChatGPT': 'GPT',
        'Claude': 'CL',
        'Gemini': 'GM',
        'Perplexity': 'PX',
        'Copilot': 'CP'
      };
      return icons[engine] || engine.substring(0, 2).toUpperCase();
    }
    
    function transformAIInsights(root){
      const title = [...root.querySelectorAll('h2,h3,h4,.section-title')].find(n => 
        /ai\s*engine\s*insights?/i.test((n.textContent || '').trim())
      );
      if (!title) return;
      
      let ul = title.nextElementSibling;
      while (ul && ul.tagName && ul.tagName.toLowerCase() !== 'ul') {
        ul = ul.nextElementSibling;
      }
      if (!ul) return;
      
      const bullets = [...ul.querySelectorAll('li')].map(li => (li.textContent || '').trim());
      if (!bullets.length) return;
      
      const engines = ['ChatGPT','Claude','Gemini','Copilot','Perplexity'];
      const box = document.createElement('div'); 
      box.className = 'llm-insights';
      
      engines.forEach((e, i) => {
        const t = bullets[i]; 
        if (!t) return; 
        const row = document.createElement('div'); 
        row.className = 'llm-row'; 
        row.appendChild(logoDivFor(e)); 
        const p = document.createElement('p'); 
        p.textContent = t; 
        row.appendChild(p); 
        box.appendChild(row);
      });
      
      ul.replaceWith(box);
    }
    
    function renderScoreCard(total, pillars, highlights){
      document.getElementById("scoreNumber").textContent = `${total}/100`;
      document.getElementById("scoreBand").textContent =
        total >= 80 ? "Rank: Excellent ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ" :
        total >= 60 ? "Rank: Good ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ" :
        total >= 40 ? "Rank: Fair ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ" :
        "Rank: Needs Improvement ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ";
        
      const grid = document.getElementById("pillarsGrid"); 
      grid.innerHTML = "";
      [
        ["AI Access Readiness", pillars.access],
        ["Trust & Verification Signals", pillars.trust],
        ["LLM Interpretability & Clarity", pillars.clarity],
        ["Prompt-Pattern Alignment", pillars.alignment]
      ].forEach(([label, val]) => {
        const d = document.createElement("div"); 
        d.className = "pillar"; 
        d.innerHTML = `<span class="label">${label}</span><span class="badge">${val}/25</span>`; 
        grid.appendChild(d);
      });
      
      if (highlights && highlights.length) {
        const ul = document.getElementById("highlightsList"); 
        ul.innerHTML = ""; 
        highlights.forEach(h => {
          const li = document.createElement("li"); 
          li.textContent = h; 
          ul.appendChild(li);
        }); 
        document.getElementById("highlightsBlock").hidden = false;
      }
    }

    const urlParams = new URLSearchParams(window.location.search);
    const targetUrl = urlParams.get("url");
    
    function startProgress() {
      document.getElementById('progress-overlay').style.display = 'flex';
      const circumference = 2 * Math.PI * 45;
      const progressCircle = document.getElementById('progressCircle');
      const progressPercentage = document.getElementById('progressPercentage');
      const progressStatus = document.getElementById('progressStatus');
      const progressEta = document.getElementById('progressEta');
      
      progressCircle.style.strokeDasharray = `0 ${circumference}`;
      
      const expectedDuration = 30000;
      const startTime = Date.now();
      
      const statuses = [
        { percent: 20, status: "Fetching website content...", eta: "Analyzing site structure and content..." },
        { percent: 45, status: "Analyzing performance metrics...", eta: "Processing technical SEO factors..." },
        { percent: 70, status: "Running AI analysis...", eta: "Evaluating AI engine compatibility..." },
        { percent: 90, status: "Generating recommendations...", eta: "Almost done! Finalizing report..." }
      ];
      
      const interval = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const ratio = Math.min(elapsed / expectedDuration, 1);
        const progress = ratio * 95;
        
        const offset = circumference - (progress / 100) * circumference * 0.75;
        progressCircle.style.strokeDasharray = `${circumference * 0.75 - offset} ${circumference}`;
        
        progressPercentage.textContent = Math.floor(progress) + '%';
        
        const currentStatus = statuses.find(s => progress <= s.percent) || statuses[statuses.length - 1];
        progressStatus.textContent = currentStatus.status;
        progressEta.innerHTML = currentStatus.eta + '<br>This typically takes <strong>15-45 seconds</strong>.';
        
        if (progress >= 95) {
          clearInterval(interval);
        }
      }, 150);
      
      return interval;
    }

    function stopProgress() {
      const circumference = 2 * Math.PI * 45;
      const progressCircle = document.getElementById('progressCircle');
      const progressPercentage = document.getElementById('progressPercentage');
      
      progressCircle.style.transition = 'stroke-dasharray 0.5s ease';
      progressCircle.style.strokeDasharray = `${circumference * 0.75} ${circumference}`;
      progressPercentage.textContent = '100%';
      
      setTimeout(() => {
        document.getElementById('progress-overlay').style.display = 'none';
      }, 800);
    }

    document.getElementById('breakdownBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('breakdown-modal').style.display = 'flex';
    });
    
    document.getElementById('modal-close').addEventListener('click', () => {
      document.getElementById('breakdown-modal').style.display = 'none';
    });
    
    document.getElementById('breakdown-modal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('breakdown-modal')) {
        document.getElementById('breakdown-modal').style.display = 'none';
      }
    });

    document.getElementById("copyBtn").addEventListener("click", async () => {
      const scoreText = document.getElementById("scoreNumber").textContent || "-/100";
      const labels = [...document.querySelectorAll('.pillar .label')].map(el => el.textContent.trim());
      const vals = [...document.querySelectorAll('.pillar .badge')].map(el => el.textContent.trim());
      const highlights = [...document.querySelectorAll('#highlightsList li')].map(li => li.textContent.trim());
      
      const txt = [
        `Website: ${targetUrl}`,
        `SnipeRank Score: ${scoreText}`,
        `Pillars:`, ...labels.map((l, i) => `- ${l}: ${vals[i] || ''}`),
        ``, `Highlights/Issues:`, ...highlights.map(h => `- ${h}`)
      ].join("\n");
      
      try { 
        await navigator.clipboard.writeText(txt);
        const b = document.getElementById("copyBtn"); 
        const old = b.textContent; 
        b.textContent = "Copied!"; 
        setTimeout(() => b.textContent = old, 1500);
      } catch { 
        window.prompt("Copy the summary:", txt); 
      }
    });

    document.getElementById('full-report-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('name-input').value.trim();
      const email = document.getElementById('email-input').value.trim();
      const phone = document.getElementById('phone-input').value.trim();
      const company = document.getElementById('company-input').value.trim();
      const context = document.getElementById('context-input').value.trim();
      
      if (!name || !email || !phone || !targetUrl) return;
      
      sessionStorage.setItem('sniperank:name', name);
      sessionStorage.setItem('sniperank:email', email);
      sessionStorage.setItem('sniperank:phone', phone);
      sessionStorage.setItem('sniperank:company', company);
      sessionStorage.setItem('sniperank:context', context);
      sessionStorage.setItem('sniperank:url', targetUrl);
      
      window.location.href = `full-report.html?url=${encodeURIComponent(targetUrl)}`;
    });

    document.addEventListener("DOMContentLoaded", async () => {
      if (!targetUrl) {
        document.getElementById("current-url").textContent = "No URL provided";
        document.getElementById('summary-results').innerHTML = "<p style='text-align:center;color:red'>No URL provided. Please go back to the homepage.</p>";
        return;
      }
      
      document.getElementById("current-url").textContent = targetUrl;
      
      const progressTimer = startProgress();

      let apiBase = '';
      try {
        const probe = await fetch('/api/score?url=' + encodeURIComponent('https://example.com'), {method:'HEAD'});
        if (!probe.ok) throw 0;
      } catch { 
        apiBase = 'https://sniperank-app2.onrender.com'; 
      }

      try {
        const r = await fetch(`${apiBase}/api/score?url=${encodeURIComponent(targetUrl)}`);
        const j = await r.json();
        renderScoreCard(j.score, j.pillars, j.highlights);
        
        sessionStorage.setItem('sniperank:url', targetUrl);
        sessionStorage.setItem('sniperank:data', JSON.stringify(j));
      } catch (e) {
        console.error('Score error:', e);
      }

      try {
        const res = await fetch(`${apiBase}/report.html?report=analyze&url=${encodeURIComponent(targetUrl)}`);
        const html = await res.text();
        const host = document.getElementById('summary-results'); 
        host.innerHTML = html; 
        transformAIInsights(host);
      } catch {
        document.getElementById('summary-results').innerHTML = "<p style='text-align:center;color:red'>Error loading analysis report.</p>";
      } finally {
        clearInterval(progressTimer);
        stopProgress();
      }
    });
  </script>
</body>
</html>
