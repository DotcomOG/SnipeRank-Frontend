<!DOCTYPE html>
<!-- full-report.html â€” v4.0.0 (Oct 27, 2025)
     - Mirrors analyze.html card layout
     - LLM logos shown in â€œAI Engines Coveredâ€ row (not in score card)
     - Renders rich items: title, why, solution, priority (with fallback to strings)
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SnipeRank â€” Full AI SEO Analysis Report</title>
  <style>
    :root{
      --max:760px; --pad:22px; --muted:#6b7280; --border:#e5e7eb;
      --ink:#0f172a; --accent:#dc3545; --bg:#ffffff; --chip:#f8fafc;
      --shadow:0 10px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:var(--max);margin:44px auto;padding:0 20px}
    h1{margin:0;font-size:42px;line-height:1.05;
      background:linear-gradient(135deg,#000 0%,#3182CE 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .sub{margin:4px 0 22px;color:var(--muted)}
    .card{border:1px solid var(--border);border-radius:16px;background:#fff;box-shadow:var(--shadow);padding:var(--pad)}
    .score-row{display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap}
    .score-num{font-weight:800;font-size:28px}
    .btn{appearance:none;border:0;border-radius:999px;background:var(--accent);color:#fff;
      padding:10px 16px;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:default}
    .badge{display:inline-block;padding:2px 10px;border-radius:999px;background:var(--chip);
      border:1px solid var(--border);font-weight:600}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .kpi{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border:1px solid var(--border);
      border-radius:10px;flex:1 1 180px;min-width:180px;background:#fff}
    .notice{background:#fff8e1;border:1px solid #ffe08a;color:#7a5b00;padding:10px;border-radius:8px;margin:14px 0}
    .section{margin-top:26px}
    .section h3{margin:0 0 10px}
    ul{margin:8px 0 0 18px}
    li{margin:7px 0;line-height:1.6}
    .muted{color:var(--muted)}
    .pill{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .chip{border:1px solid var(--border);border-radius:10px;background:#fff;padding:8px 10px}
    .engines{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .engines img{width:22px;height:22px;border-radius:4px;object-fit:cover;border:1px solid var(--border)}
    .footer{margin:40px 0 10px;text-align:center;color:var(--muted);font-size:13px}
    .spinner{width:16px;height:16px;border:2px solid #ddd;border-top-color:#666;border-radius:50%;
      display:inline-block;animation:spin 1s linear infinite;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    .priority{font-weight:700;margin-left:6px}
    .why{color:#111}
    .solution{color:#0a5;display:block;margin-top:3px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>SnipeRank</h1>
    <div class="sub">Full AI SEO Analysis Report â€¢ Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>

    <div id="notice" class="notice" style="display:none"></div>

    <div class="card">
      <div class="score-row">
        <div>
          <div class="muted">Analysis for</div>
          <div id="target-url" style="font-weight:700">â€”</div>
        </div>
        <div class="score-num" id="score">Generatingâ€¦</div>
        <button id="copyBtn" class="btn" type="button">Copy Comprehensive Summary</button>
      </div>

      <!-- KPI line (mirrors analyze) -->
      <div class="row" style="margin-top:10px">
        <div class="kpi"><span>Content Clarity & Structure</span><span class="badge" id="kpi1">â€”/25</span></div>
        <div class="kpi"><span>AI Engine Optimization</span><span class="badge" id="kpi2">â€”/25</span></div>
        <div class="kpi"><span>Technical Implementation</span><span class="badge" id="kpi3">â€”/25</span></div>
        <div class="kpi"><span>Competitive Positioning</span><span class="badge" id="kpi4">â€”/25</span></div>
      </div>

      <!-- AI Engines Covered (logos BELOW the score card, not inside it) -->
      <div class="section" style="margin-top:14px">
        <div class="muted" style="margin-bottom:6px">AI Engines Covered</div>
        <div class="engines">
          <span class="chip"><img src="/img/claude.jpeg" alt="Claude"/> Claude</span>
          <span class="chip"><img src="/img/gemini.jpeg" alt="Gemini"/> Gemini</span>
          <span class="chip"><img src="/img/copilot.jpeg" alt="Copilot"/> Copilot</span>
          <span class="chip"><img src="/img/gemini.jpeg" alt="Perplexity" style="filter:grayscale(1)"/> Perplexity</span>
          <span class="chip"><img src="/img/claude.jpeg" alt="ChatGPT" style="filter:grayscale(1)"/> ChatGPT</span>
        </div>
      </div>
    </div>

    <!-- Report sections -->
    <div id="report-content" class="section">
      <p class="muted"><span class="spinner"></span> Generating comprehensive reportâ€¦</p>
    </div>

    <div class="section">
      <a class="btn" href="https://calendly.com/quontora" target="_blank" rel="noopener">Schedule Strategy Session</a>
    </div>

    <div class="footer">Â© 2025 SnipeRank by quontora.com</div>
  </div>

  <script>
    // ==== CONFIG ====
    // Use the working Render backend. Change here only if you deliberately move backends.
    const API_BASE = "https://sniperank-v2-dev.onrender.com";

    const qs = new URLSearchParams(location.search);
    const targetUrl = qs.get("url") || "";
    document.getElementById("target-url").textContent = targetUrl || "â€”";

    const noticeEl = document.getElementById("notice");
    const reportEl  = document.getElementById("report-content");

    function setNotice(msg){ noticeEl.textContent = msg; noticeEl.style.display = "block"; }

    function renderKpis(score){
      // simple visual split; keeps parity with analyze look
      const q = Math.max(0, Math.min(25, Math.round((score||0)/4)));
      ["kpi1","kpi2","kpi3","kpi4"].forEach(id => document.getElementById(id).textContent = q + "/25");
    }

    function renderScore(score){
      document.getElementById("score").textContent = (score ?? 0) + "/100";
      renderKpis(score ?? 0);
    }

    function asItemHTML(item){
      // Support both rich objects and plain strings (fallback)
      if (typeof item === "string"){
        return `<li>${item}</li>`;
      }
      const t = item.title || "Issue";
      const why = item.why || "";
      const sol = item.solution || "";
      const pr  = item.priority ? `<span class="priority">(${item.priority})</span>` : "";
      return `<li><strong>${t}</strong> ${pr}<br><span class="why">${why}</span>${sol ? `<span class="solution">Fix: ${sol}</span>`:""}</li>`;
    }

    function listToHTML(items){
      return (items || []).map(asItemHTML).join("");
    }

    function renderLists(data){
      const needsHTML   = listToHTML(data.needsAttention);
      const workingHTML = listToHTML(data.whatsWorking);
      const enginesHTML = (data.engineInsights || []).map(e => {
        if (typeof e === "string") return `<li>${e}</li>`;
        return `<li><strong>${e.engine || "Engine"}:</strong> ${e.tip || ""}</li>`;
      }).join("");

      reportEl.innerHTML = `
        <div class="section">
          <h3>Priority Opportunities</h3>
          <ul>${needsHTML}</ul>
        </div>
        <div class="section">
          <h3>âœ… Whatâ€™s Working</h3>
          <ul>${workingHTML}</ul>
        </div>
        <div class="section">
          <h3>ðŸ¤– AI Engine Insights</h3>
          <ul>${enginesHTML}</ul>
        </div>
      `;
    }

    async function loadFullReport(){
      if(!targetUrl){
        reportEl.innerHTML = `<p class="muted">No URL provided.</p>`;
        return;
      }
      try{
        const res = await fetch(`${API_BASE}/api/full?url=${encodeURIComponent(targetUrl)}`);
        const data = await res.json();

        if (!data || data.error){
          reportEl.innerHTML = `<p class="muted">Error loading comprehensive analysis. Please try again.</p>`;
          return;
        }

        if (data.success !== true){
          setNotice('âš ï¸ Showing Lite analysis (temporary). The comprehensive AI report service was unavailable.');
        }

        renderScore(data.score || 50);
        renderLists(data);

        document.getElementById("copyBtn").onclick = async () => {
          const lines = [
            `Comprehensive AI SEO Analysis`,
            `Website: ${targetUrl}`,
            `Overall Score: ${document.getElementById("score").textContent}`,
            ``,
            `Top Opportunities:`,
            ...(Array.isArray(data.needsAttention) ? data.needsAttention.slice(0,10).map(i => {
              const s = (typeof i === "string") ? i : `${i.title}: ${i.solution || i.why || ""}`;
              return `- ${s}`;
            }) : []),
            ``,
            `AI Engine Insights:`,
            ...(Array.isArray(data.engineInsights) ? data.engineInsights.map(i=>{
              const s = (typeof i === "string") ? i : `${i.engine}: ${i.tip}`;
              return `- ${s}`;
            }) : []),
            ``,
            `Generated by SnipeRank`
          ].join("\n");
          try{ await navigator.clipboard.writeText(lines);
               const b=document.getElementById("copyBtn"); const old=b.textContent; b.textContent="Copied!"; setTimeout(()=>b.textContent=old,1500);
          }catch{ window.prompt("Copy the summary:", lines); }
        };

      }catch(err){
        console.error(err);
        reportEl.innerHTML = `<p class="muted">Error loading comprehensive analysis. Please try again.</p>`;
      }
    }

    renderScore(0);
    loadFullReport();
  </script>
</body>
</html>
