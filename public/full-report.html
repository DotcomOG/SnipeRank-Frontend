<!DOCTYPE html>
<!--
  SnipeRank ‚Äî Full Report (v1.0-main)
  Last updated: 2025-10-27
  Notes:
  - Visual + structure mirror analyze.html (score card, pills, spacing)
  - Loading overlay with progress bar
  - LLM logos rendered from /public/img:
      /img/claude.jpeg, /img/gemini.jpeg, /img/copilot.jpeg, /img/chatgpt-logo.png
  - Backend: https://sniperank-v2-dev.onrender.com
-->
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SnipeRank ‚Äî Full AI SEO Analysis</title>
  <style>
    :root{
      --max: 920px;
      --pad: 24px;
      --muted: #6b7280;
      --border:#e5e7eb;
      --ink:#0f172a;
      --bg:#ffffff;
      --accent:#e11d48;
      --accent-2:#ef4444;
      --ok:#16a34a;
      --chip:#f8fafc;
      --shadow:0 10px 30px rgba(0,0,0,.10);
      --pill:#f1f5f9;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
    .wrap{max-width:var(--max);margin:36px auto;padding:0 18px}
    h1{font-size:44px;line-height:1.05;margin:0 0 6px;background:linear-gradient(135deg,#0b1220 0%,#2563eb 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800}
    .sub{color:var(--muted);margin:2px 0 22px}
    /* Score Card (same silhouette as analyze) */
    .card{border:1px solid var(--border);border-radius:16px;background:#fff;box-shadow:var(--shadow);padding:16px}
    .scorebar{display:flex;align-items:center;gap:16px;flex-wrap:wrap;justify-content:space-between}
    .score-num{font-size:34px;font-weight:800}
    .pillrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .pill{background:var(--pill);border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-weight:600;font-size:14px;display:inline-flex;gap:8px;align-items:center}
    .pill .subval{font-weight:700;border:1px solid var(--border);background:#fff;border-radius:999px;padding:2px 8px}
    .btn{background:var(--accent);color:#fff;border:0;border-radius:999px;padding:10px 16px;font-weight:700;cursor:pointer;white-space:nowrap}
    .btn:disabled{opacity:.7;cursor:default}
    .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);border-radius:10px;background:#fff;padding:4px 8px;font-size:13px}
    .engines{display:flex;gap:8px;flex-wrap:wrap}
    .engine-chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:var(--chip);border-radius:999px;padding:6px 10px}
    .engine-chip img{width:18px;height:18px;border-radius:4px;object-fit:cover}
    .grid{display:grid;grid-template-columns:1.05fr .95fr;gap:18px;margin-top:20px}
    .section{border:1px solid var(--border);border-radius:14px;background:#fff;padding:16px}
    .section h3{margin:0 0 8px}
    ul{margin:8px 0 0 20px}
    li{margin:6px 0;line-height:1.6}
    .howfix{background:#f8fafc;border:1px solid var(--border);border-left:3px solid var(--accent-2);border-radius:10px;padding:10px;margin:8px 0 2px}
    .ok{color:var(--ok)}
    .warn{background:#fff8e1;border:1px solid #ffe08a;color:#7a5b00;border-radius:8px;padding:10px;margin:12px 0}
    .footer{margin:40px 0 10px;color:var(--muted);text-align:center;font-size:13px}
    /* Loading overlay */
    .overlay{position:fixed;inset:0;background:rgba(248,250,252,.95);display:none;align-items:center;justify-content:center;z-index:50}
    .panel{width:min(560px,92vw);border:1px solid var(--border);border-radius:16px;background:#fff;box-shadow:var(--shadow);padding:22px}
    .bar{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .fill{height:100%;width:0%;background:#2563eb;transition:width .35s ease}
    .tiny{color:var(--muted);font-size:13px;margin-top:8px}
    @media (max-width:880px){ .grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="overlay" id="overlay">
    <div class="panel">
      <h2 style="margin:0 0 8px">Generating comprehensive report‚Ä¶</h2>
      <div class="bar"><div class="fill" id="bar"></div></div>
      <div class="tiny" id="pct">0%</div>
    </div>
  </div>

  <div class="wrap">
    <h1>SnipeRank</h1>
    <div class="sub">Full AI SEO Analysis Report ‚Ä¢ Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>

    <div id="notice" class="warn" style="display:none"></div>

    <div class="card">
      <div class="scorebar">
        <div>
          <div class="muted" style="color:var(--muted)">Analysis for</div>
          <div id="target" style="font-weight:800">‚Äî</div>
        </div>
        <div class="score-num" id="score">Generating‚Ä¶</div>
        <button id="copyBtn" class="btn" type="button">Copy Comprehensive Summary</button>
      </div>

      <div style="margin-top:12px;display:flex;justify-content:space-between;gap:14px;flex-wrap:wrap">
        <div class="pillrow" id="pillrow">
          <div class="pill">AI Access Readiness <span class="subval" id="p1">‚Äî</span></div>
          <div class="pill">Trust &amp; Verification Signals <span class="subval" id="p2">‚Äî</span></div>
          <div class="pill">LLM Interpretability &amp; Clarity <span class="subval" id="p3">‚Äî</span></div>
          <div class="pill">Prompt-Pattern Alignment <span class="subval" id="p4">‚Äî</span></div>
        </div>
        <div class="engines">
          <span class="engine-chip"><img src="/img/claude.jpeg" alt="Claude"/>Claude</span>
          <span class="engine-chip"><img src="/img/gemini.jpeg" alt="Gemini"/>Gemini</span>
          <span class="engine-chip"><img src="/img/copilot.jpeg" alt="Copilot"/>Copilot</span>
          <span class="engine-chip"><img src="/img/chatgpt-logo.png" alt="ChatGPT"/>ChatGPT</span>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="section" id="opportunities">
        <h3>üî¥ Comprehensive Opportunities</h3>
        <div id="needsList"><p style="color:var(--muted)">Building detailed recommendations‚Ä¶</p></div>
      </div>

      <div class="section" id="engines">
        <h3>ü§ñ AI Engine Insights</h3>
        <div id="engineList"><p style="color:var(--muted)">Loading per-engine insights‚Ä¶</p></div>
      </div>
    </div>

    <div class="section" style="margin-top:18px" id="working">
      <h3 class="ok">‚úÖ What‚Äôs Working</h3>
      <div id="workList"><p style="color:var(--muted)">Collecting strengths‚Ä¶</p></div>
    </div>

    <div style="margin-top:18px">
      <a class="btn" href="https://calendly.com/quontora" target="_blank" rel="noopener">Schedule Strategy Session</a>
    </div>

    <div class="footer">¬© 2025 SnipeRank by quontora.com</div>
  </div>

  <script>
    // === Config ===
    const API_BASE = "https://sniperank-v2-dev.onrender.com"; // Render backend
    const qs = new URLSearchParams(location.search);
    const targetUrl = qs.get("url") || "";
    document.getElementById("target").textContent = targetUrl || "‚Äî";

    // Loading overlay animation (simple, deterministic)
    const overlay = document.getElementById('overlay');
    const bar = document.getElementById('bar');
    const pct = document.getElementById('pct');
    let prog = 0, timer = null;
    function startOverlay(){
      overlay.style.display = "flex";
      prog = 0;
      timer = setInterval(()=>{
        prog = Math.min(97, prog + Math.random()*6 + 2);
        bar.style.width = prog.toFixed(0) + "%";
        pct.textContent = bar.style.width;
      }, 260);
    }
    function stopOverlay(){
      if(timer){ clearInterval(timer); timer = null; }
      bar.style.width = "100%"; pct.textContent = "100%";
      setTimeout(()=>overlay.style.display="none", 250);
    }

    // Evenly split the overall score into 4 sub-pillars for display only
    function splitScore(s){
      const base = Math.max(0, Math.min(100, Number(s)||0));
      const q = Math.floor(base/4);
      const r = base - q*4; // distribute remainder
      return [q+(r>0?1:0), q+(r>1?1:0), q+(r>2?1:0), q];
    }

    function esc(s){ return (""+s).replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }

    function renderNeeds(needs){
      if(!Array.isArray(needs) || needs.length===0){
        return `<p style="color:var(--muted)">No priority issues detected.</p>`;
      }
      return `<ul>` + needs.map(txt=>{
        // Heuristic: if incoming text lacks a fix, add a helper ‚ÄúHow to fix‚Äù block beneath.
        const t = ""+txt;
        let fix = "";
        if(/structured data|schema/i.test(t)){
          fix = "Add JSON-LD for Organization, WebSite and key Service/Product pages. Validate in Google‚Äôs Rich Results Test.";
        }else if(/meta description/i.test(t)){
          fix = "Write a 150‚Äì160 character, task-focused description per page including primary entity and intent.";
        }else if(/alt/i.test(t)){
          fix = "Add descriptive <code>alt</code> text to meaningful images. Use nouns + action (e.g., ‚ÄúVolunteer serving meals at community center‚Äù).";
        }
        return `
          <li>${esc(t)}</li>
          ${fix ? `<div class="howfix"><strong>How to fix:</strong> ${fix}</div>` : ``}
        `;
      }).join("") + `</ul>`;
    }

    function logoForEngine(name){
      const key = (name||"").toLowerCase();
      if(key.includes("claude")) return "/img/claude.jpeg";
      if(key.includes("gemini")) return "/img/gemini.jpeg";
      if(key.includes("copilot")) return "/img/copilot.jpeg";
      // default chatgpt / perplexity fall back to chatgpt logo if not supplied
      return "/img/chatgpt-logo.png";
    }

    function renderEngineInsights(items){
      if(!Array.isArray(items) || items.length===0){
        return `<p style="color:var(--muted)">No engine-specific notes available.</p>`;
      }
      return items.map(line=>{
        const text = ""+line;
        // Try to extract engine name before ":" else fallback
        const m = text.match(/^([A-Za-z ]+)\s*:\s*(.+)$/);
        const name = m ? m[1].trim() : "ChatGPT";
        const note = m ? m[2].trim() : text;
        const logo = logoForEngine(name);
        return `
          <div class="badge" style="display:flex;align-items:flex-start;gap:10px;margin:8px 0">
            <img src="${logo}" alt="${esc(name)}" style="width:22px;height:22px;border-radius:4px;object-fit:cover"/>
            <div><strong>${esc(name)}:</strong> ${esc(note)}</div>
          </div>
        `;
      }).join("");
    }

    function renderList(list){
      if(!Array.isArray(list) || list.length===0){
        return `<p style="color:var(--muted)">No items found.</p>`;
      }
      return `<ul>` + list.map(x=>`<li>${esc(x)}</li>`).join("") + `</ul>`;
    }

    async function loadReport(){
      if(!targetUrl){
        document.getElementById("notice").style.display="block";
        document.getElementById("notice").textContent = "No URL provided.";
        return;
      }
      startOverlay();
      try{
        const res = await fetch(`${API_BASE}/api/full?url=${encodeURIComponent(targetUrl)}`);
        const data = await res.json();

        // lite / fallback notice
        if(!data || data.error){
          const n = document.getElementById("notice");
          n.style.display="block";
          n.textContent = "Error loading comprehensive analysis. Showing nothing.";
          stopOverlay();
          return;
        }
        if(data.success !== true){
          const n = document.getElementById("notice");
          n.style.display="block";
          n.textContent = "Showing Lite analysis (temporary). The comprehensive AI report service was unavailable.";
        }

        // Score + pillars (visual parity with analyze)
        const score = Number(data.score || 50);
        document.getElementById("score").textContent = `${score}/100`;
        const [a,b,c,d] = splitScore(score).map(v=>`${v}/25`);
        document.getElementById("p1").textContent = a;
        document.getElementById("p2").textContent = b;
        document.getElementById("p3").textContent = c;
        document.getElementById("p4").textContent = d;

        // Sections
        document.getElementById("needsList").innerHTML = renderNeeds(data.needsAttention || []);
        document.getElementById("workList").innerHTML  = renderList(data.whatsWorking || []);
        document.getElementById("engineList").innerHTML= renderEngineInsights(data.engineInsights || []);

        // Copy button
        document.getElementById("copyBtn").onclick = async () => {
          const lines = [
            `SnipeRank ‚Äî Comprehensive AI SEO Report`,
            `Site: ${targetUrl}`,
            `Score: ${score}/100`,
            ``,
            `Top Opportunities:`,
            ...(data.needsAttention||[]).slice(0,12).map(x=>`- ${x}`),
            ``,
            `AI Engine Insights:`,
            ...(data.engineInsights||[]).map(x=>`- ${x}`),
            ``,
            `Strengths:`,
            ...(data.whatsWorking||[]).slice(0,10).map(x=>`- ${x}`)
          ].join("\n");
          try{
            await navigator.clipboard.writeText(lines);
            const btn = document.getElementById("copyBtn");
            const old = btn.textContent; btn.textContent = "Copied!"; setTimeout(()=>btn.textContent=old,1200);
          }catch{ window.prompt("Copy summary:", lines); }
        };

      }catch(err){
        const n = document.getElementById("notice");
        n.style.display="block";
        n.textContent = "Network error loading comprehensive analysis.";
        console.error(err);
      }finally{
        stopOverlay();
      }
    }

    loadReport();
  </script>
</body>
</html>
