<!DOCTYPE html>
<!--
  public/full-report.html
  SnipeRank ‚Äî Full AI SEO Analysis (single-API)
  Version: v3.7.1 ‚Äî Oct 27, 2025
  - Matches Analyze visual style
  - LLM logo pills (uses /public/img assets; hides missing logos gracefully)
  - Works with one endpoint: /api/full
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SnipeRank ‚Äî Full AI SEO Analysis Report</title>
  <style>
    :root{
      --max: 880px;
      --muted:#6b7280; --border:#e5e7eb; --black:#0f172a;
      --bg:#ffffff; --pill:#fafafa; --shadow:0 10px 30px rgba(0,0,0,.08);
      --accent:#e11d48;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--black);background:var(--bg);}
    .wrap{max-width:var(--max);margin:40px auto;padding:0 20px}
    h1{font-size:44px;line-height:1.1;margin:0 0 6px;
      background:linear-gradient(135deg,#111 0%,#3182CE 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .sub{color:var(--muted);margin:2px 0 18px}
    .card{border:1px solid var(--border);border-radius:16px;background:#fff;box-shadow:var(--shadow);padding:16px}
    .row{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .score{font-size:30px;font-weight:800}
    .btn{background:var(--accent);color:#fff;border:0;border-radius:999px;padding:10px 16px;font-weight:700;cursor:pointer}
    .pillbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .pill{display:flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fafafa;font-weight:600}
    .pill img{width:18px;height:18px;border-radius:4px;object-fit:cover}
    .meta{color:var(--muted);font-size:14px}

    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:12px}
    .kpi{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:12px;padding:8px 10px;background:#fff}
    .badge{font-weight:800;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#fff}

    .section{margin-top:24px}
    .section h3{margin:0 0 10px}
    ul{margin:6px 0 0 20px}
    li{margin:8px 0;line-height:1.65}
    .fix{color:#0b5; display:block; margin-top:4px; font-size:14px}
    .prio{font-weight:800}

    .note{background:#fff8e1;border:1px solid #ffe08a;color:#7a5b00;padding:10px;border-radius:10px;margin:16px 0}
    .err{color:#b91c1c}
    .footer{margin:40px 0 10px;color:var(--muted);text-align:center;font-size:13px}
    .spinner{width:16px;height:16px;border:2px solid #ddd;border-top-color:#666;border-radius:50%;display:inline-block;animation:spin 1s linear infinite;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (max-width:720px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>SnipeRank</h1>
    <div class="sub">Full AI SEO Analysis Report ‚Ä¢ Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>

    <div id="notice" class="note" style="display:none"></div>

    <div class="card">
      <div class="row">
        <div>
          <div class="meta">Analysis for</div>
          <div id="target-url" style="font-weight:800">‚Äî</div>
        </div>
        <div class="score" id="score">Generating‚Ä¶</div>
        <button id="copyBtn" class="btn" type="button">Copy Comprehensive Summary</button>
      </div>

      <!-- LLM logos (uses existing /public/img assets) -->
      <div class="pillbar">
        <div class="pill">
          <img src="img/claude.jpeg" alt="" onerror="this.style.display='none'"> Claude
        </div>
        <div class="pill">
          <img src="img/gemini.jpeg" alt="" onerror="this.style.display='none'"> Gemini
        </div>
        <div class="pill">
          <img src="img/copilot.jpeg" alt="" onerror="this.style.display='none'"> Copilot
        </div>
        <div class="pill">
          <img src="img/chatgpt.jpeg" alt="" onerror="this.style.display='none'"> ChatGPT
        </div>
      </div>

      <!-- four KPIs: mirrors Analyze -->
      <div class="grid">
        <div class="kpi"><span>Content Clarity & Structure</span><span class="badge" id="k1">‚Äî</span></div>
        <div class="kpi"><span>AI Engine Optimization</span><span class="badge" id="k2">‚Äî</span></div>
        <div class="kpi"><span>Technical Implementation</span><span class="badge" id="k3">‚Äî</span></div>
        <div class="kpi"><span>Competitive Positioning</span><span class="badge" id="k4">‚Äî</span></div>
      </div>
    </div>

    <div id="report" class="section">
      <p class="meta"><span class="spinner"></span> Generating comprehensive report‚Ä¶</p>
    </div>

    <div class="section">
      <a class="btn" href="https://calendly.com/quontora" target="_blank" rel="noopener">Schedule Strategy Session</a>
    </div>

    <div class="footer">¬© 2025 SnipeRank by quontora.com</div>
  </div>

  <script>
    // Single API base (Render)
    const API_BASE = "https://sniperank-v2-dev.onrender.com";

    // Query params
    const qs = new URLSearchParams(location.search);
    const targetUrl = qs.get("url") || "";
    document.getElementById("target-url").textContent = targetUrl || "‚Äî";

    const noticeEl = document.getElementById("notice");
    const reportEl = document.getElementById("report");
    const scoreEl  = document.getElementById("score");

    function showNotice(msg){ noticeEl.textContent = msg; noticeEl.style.display = "block"; }
    function renderPillars(score){
      const q = Math.max(0, Math.min(25, Math.round((score||50)/4)));
      ['k1','k2','k3','k4'].forEach(id => document.getElementById(id).textContent = `${q}/25`);
    }
    function liFrom(item){
      if (typeof item === 'string') return `<li>${item}</li>`;
      const pr = item.priority ? `<span class="prio">[PRIORITY: ${item.priority}] </span>` : '';
      const ttl = item.title ? `<strong>${item.title}</strong>` : '';
      const why = item.why ? ` ‚Äî ${item.why}` : '';
      const fix = item.solution ? `<span class="fix">Fix: ${item.solution}</span>` : '';
      return `<li>${pr}${ttl}${why}${fix}</li>`;
    }

    function buildCopySummary(data){
      const lines = [
        `Comprehensive AI SEO Analysis`,
        `Website: ${targetUrl}`,
        `Overall Score: ${scoreEl.textContent}`,
        ``,
        `Top Opportunities:`,
        ...(data.needsAttention || []).slice(0,8).map(x => `- ${typeof x==='string'?x:(x.title||'Issue')}`),
        ``,
        `AI Engine Insights:`,
        ...(data.engineInsights || []).map(x => `- ${typeof x==='string'?x:(x.tip||x.engine||'Insight')}`),
        ``,
        `Generated by SnipeRank`
      ].join("\n");
      return lines;
    }

    async function loadReport(){
      if(!targetUrl){
        reportEl.innerHTML = `<p class="err">No URL provided.</p>`;
        return;
      }
      try{
        const res = await fetch(`${API_BASE}/api/full?url=${encodeURIComponent(targetUrl)}`);
        const data = await res.json();

        if (!data || data.error){
          reportEl.innerHTML = `<p class="err">Error loading comprehensive analysis. Please try again.</p>`;
          return;
        }
        if (data.success !== true){
          showNotice('‚ö†Ô∏è Showing Lite analysis (temporary). The comprehensive AI report service was unavailable.');
        }

        const score = Number(data.score) || 50;
        scoreEl.textContent = `${score}/100`;
        renderPillars(score);

        const needs  = (data.needsAttention || []).map(liFrom).join("");
        const works  = (data.whatsWorking || []).map(liFrom).join("");
        const engine = (data.engineInsights || []).map(liFrom).join("");

        reportEl.innerHTML = `
          <div class="section">
            <h3>Priority Opportunities</h3>
            <ul>${needs}</ul>
          </div>
          <div class="section">
            <h3>‚úÖ What‚Äôs Working</h3>
            <ul>${works}</ul>
          </div>
          <div class="section">
            <h3>ü§ñ AI Engine Insights</h3>
            <ul>${engine}</ul>
          </div>
        `;

        document.getElementById("copyBtn").onclick = async () => {
          const payload = buildCopySummary(data);
          try{
            await navigator.clipboard.writeText(payload);
            const b = document.getElementById("copyBtn");
            const old = b.textContent; b.textContent = "Copied!"; setTimeout(()=>b.textContent=old,1500);
          }catch{ window.prompt("Copy the summary:", payload); }
        };
      }catch(err){
        console.error(err);
        reportEl.innerHTML = `<p class="err">Error loading comprehensive analysis. Please try again.</p>`;
      }
    }

    loadReport();
  </script>
</body>
</html>
