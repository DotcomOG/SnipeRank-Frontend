<!DOCTYPE html>
<!--
SnipeRank â€” Full AI SEO Analysis (v3.7.0)
Last updated: 2025-10-27
Notes:
- Matches analyze.html look/feel (score card, pills, spacing, typography)
- Uses LLM logos from /public/img (claude.jpeg, gemini.jpeg, copilot.jpeg, gpt.jpeg*)
- Pulls comprehensive data from Render backend: https://sniperank-v2-dev.onrender.com/api/full?url=...
- Shows full-screen loading overlay with progress
- For each issue, renders â€œHow to fixâ€ guidance bullets
- Safe fallback to Lite mode if backend returns success:false
* If you donâ€™t have gpt.jpeg, duplicate any logo for now and name it gpt.jpeg
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SnipeRank â€” Full AI SEO Analysis</title>
  <style>
    :root{
      --wrap: 960px;
      --pad: 22px;
      --muted:#6b7280;
      --border:#e5e7eb;
      --ink:#0f172a;
      --brand:#0a66c2;
      --card:#ffffff;
      --accent:#e11d48;
      --accent-ink:#ffffff;
      --pill:#f8fafc;
      --ok:#16a34a;
      --warn:#ca8a04;
      --bad:#dc2626;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:#fff}
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:var(--wrap);margin:40px auto;padding:0 20px}
    header h1{
      margin:0 0 8px;
      font-size:44px; line-height:1.05;
      background:linear-gradient(135deg,#000 0%,#3182CE 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      letter-spacing:.3px;
    }
    header .sub{color:var(--muted);font-size:14px}
    /* Score Card */
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:var(--pad)}
    .score-row{display:flex;gap:18px;justify-content:space-between;align-items:center;flex-wrap:wrap}
    .score-num{font-size:34px;font-weight:800}
    .score-pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:var(--pill);font-weight:600}
    .score-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;margin-top:10px}
    .btn{background:var(--accent);color:var(--accent-ink);border:0;border-radius:999px;padding:10px 16px;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:default}
    /* Sections */
    .section{margin-top:26px}
    .section h3{margin:0 0 10px;font-size:18px}
    .bullets{margin:0;padding-left:20px}
    .bullets li{margin:8px 0;line-height:1.6}
    .two-col{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width:900px){ .two-col{grid-template-columns:1fr 1fr} }
    .fix{border-left:4px solid var(--brand);background:#f8fbff;padding:10px 12px;border-radius:8px}
    .note{background:#fff8e1;border:1px solid #ffe08a;color:#7a5b00;padding:10px;border-radius:8px;margin:14px 0}
    .muted{color:var(--muted)}
    .footer{margin:40px 0 10px;color:var(--muted);text-align:center;font-size:13px}
    /* Engine chips */
    .engines{display:flex;gap:8px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 10px;font-weight:700}
    .chip img{width:18px;height:18px;border-radius:4px;object-fit:cover}
    /* Loading overlay */
    .overlay{position:fixed;inset:0;background:rgba(255,255,255,.92);display:none;align-items:center;justify-content:center;z-index:9999}
    .box{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:22px;min-width:320px;text-align:center}
    .prog{height:10px;background:#eef2f7;border-radius:999px;overflow:hidden;margin-top:10px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#2563eb,#22c55e);transition:width .35s ease}
    .spinner{width:16px;height:16px;border:2px solid #ddd;border-top-color:#666;border-radius:50%;display:inline-block;animation:spin 1s linear infinite;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>SnipeRank</h1>
      <div class="sub">Full AI SEO Analysis â€¢ Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>
    </header>

    <div id="notice" class="note" style="display:none"></div>

    <section class="card" aria-label="Score">
      <div class="score-row">
        <div>
          <div class="muted">Analysis for</div>
          <div id="target-url" style="font-weight:800">â€”</div>
          <div class="engines" style="margin-top:8px">
            <span class="chip"><img src="/img/claude.jpeg" alt="">Claude</span>
            <span class="chip"><img src="/img/gemini.jpeg" alt="">Gemini</span>
            <span class="chip"><img src="/img/copilot.jpeg" alt="">Copilot</span>
            <span class="chip"><img src="/img/gpt.jpeg" alt="">ChatGPT</span>
          </div>
        </div>
        <div class="score-num" id="score">Generatingâ€¦</div>
        <button id="copyBtn" class="btn" type="button">Copy Comprehensive Summary</button>
      </div>

      <div class="score-grid" style="margin-top:14px">
        <div class="score-pill"><span>Content Clarity & Structure</span><span id="p1">â€”/25</span></div>
        <div class="score-pill"><span>AI Engine Optimization</span><span id="p2">â€”/25</span></div>
        <div class="score-pill"><span>Technical Implementation</span><span id="p3">â€”/25</span></div>
        <div class="score-pill"><span>Competitive Positioning</span><span id="p4">â€”/25</span></div>
      </div>
    </section>

    <section id="priorities" class="section">
      <h3>ðŸš¨ Comprehensive Opportunities</h3>
      <ul id="needsList" class="bullets"></ul>
    </section>

    <section class="two-col section">
      <div>
        <h3>âœ… Whatâ€™s Working</h3>
        <ul id="workingList" class="bullets"></ul>
      </div>
      <div>
        <h3>ðŸ¤– AI Engine Insights</h3>
        <div id="engineCards"></div>
      </div>
    </section>

    <section class="section">
      <a class="btn" href="https://calendly.com/quontora" target="_blank" rel="noopener">Schedule Strategy Session</a>
    </section>

    <div class="footer">Â© 2025 SnipeRank by quontora.com</div>
  </div>

  <!-- Loading overlay -->
  <div id="overlay" class="overlay" role="alert" aria-live="polite">
    <div class="box">
      <div style="font-weight:800">Generating Full Reportâ€¦ <span id="pct">0%</span></div>
      <div class="prog"><div id="bar" class="bar"></div></div>
      <div class="muted" style="margin-top:8px"><span class="spinner"></span> This can take a few seconds.</div>
    </div>
  </div>

  <script>
    // ===== CONFIG =====
    const API_BASE = "https://sniperank-v2-dev.onrender.com"; // Render backend
    // ==================

    const qs = new URLSearchParams(location.search);
    const targetUrl = qs.get("url") || "";
    const source     = qs.get("source") || "analyze";
    const name       = qs.get("name") || "";
    const email      = qs.get("email") || "";
    const domain     = qs.get("domain") || "";

    const urlEl = document.getElementById("target-url");
    urlEl.textContent = targetUrl || "â€”";

    const scoreEl = document.getElementById("score");
    const p1 = document.getElementById("p1"), p2=document.getElementById("p2"),
          p3 = document.getElementById("p3"), p4=document.getElementById("p4");
    const needsEl = document.getElementById("needsList");
    const workEl  = document.getElementById("workingList");
    const enginesEl = document.getElementById("engineCards");
    const noticeEl = document.getElementById("notice");
    const overlay = document.getElementById("overlay");
    const bar = document.getElementById("bar");
    const pct = document.getElementById("pct");

    function showOverlay(){ overlay.style.display='flex'; }
    function hideOverlay(){ overlay.style.display='none'; }
    function setProgress(n){
      const v = Math.max(0, Math.min(100, Math.round(n)));
      bar.style.width = v + '%'; pct.textContent = v + '%';
    }

    function setNotice(msg){
      noticeEl.textContent = msg;
      noticeEl.style.display = 'block';
    }

    function derivePillars(total){
      // naive split into 4 buckets, visual only
      const q = Math.max(0, Math.min(25, Math.round((total||0)/4)));
      p1.textContent = q + "/25";
      p2.textContent = q + "/25";
      p3.textContent = q + "/25";
      p4.textContent = q + "/25";
    }

    function renderBullets(list, container){
      container.innerHTML = "";
      list.forEach(item=>{
        if(typeof item === "string"){
          // auto-add "How to fix" suggestions for short items
          const fix = defaultFix(item);
          const li = document.createElement('li');
          li.innerHTML = `<div>${escapeHTML(item)}</div>${fix ? `<div class="fix"><strong>How to fix:</strong> ${fix}</div>`:''}`;
          container.appendChild(li);
        }else if(item && item.issue){
          const li = document.createElement('li');
          const how = item.how || defaultFix(item.issue);
          li.innerHTML = `<div>${escapeHTML(item.issue)}</div>${how ? `<div class="fix"><strong>How to fix:</strong> ${how}</div>`:''}`;
          container.appendChild(li);
        }
      });
    }

    const FIX_TEMPLATES = [
      { key:/meta\s*description/i, how:"Write a 150â€“160 character, task-focused summary per page including primary entity and intent. Add `<meta name=\"description\" content=\"â€¦\">` in `<head>`."},
      { key:/alt\s*text|alt\s*attributes/i, how:"Add descriptive `alt` attributes to meaningful images. Use nouns + action (e.g., â€œVolunteer serving meals at community centerâ€)."},
      { key:/structured\s*data|schema/i, how:"Add JSON-LD for `Organization`, `WebSite`, and key `Service`/`Product` pages. Validate in Googleâ€™s Rich Results Test."},
      { key:/internal\s*link/i, how:"Create 3â€“5 cross-links per page to semantically related pages using descriptive anchor text, not â€œclick here.â€"},
      { key:/title/i, how:"Use `Brand | Specific Page Topic` format. Keep under ~60 characters; ensure uniqueness per page."},
      { key:/speed|performance|lighthouse/i, how:"Compress images (AVIF/WebP), defer non-critical JS, enable HTTP caching, and lazy-load below-the-fold media."},
      { key:/mobile|responsive/i, how:"Adopt mobile-first layout, larger tap targets (â‰¥48px), and limit viewport shifts (CLS). Test with Lighthouse Mobile."},
      { key:/faq/i, how:"Publish an FAQ block answering 6â€“10 task-level questions; mark up with FAQPage schema for stronger AI snippets."},
      { key:/security|https|hsts|csp/i, how:"Enable HSTS, set a basic Content-Security-Policy, and ensure only HTTPS resources are loaded."}
    ];
    function defaultFix(txt){
      for(const t of FIX_TEMPLATES){
        if(t.key.test(txt)) return t.how;
      }
      return "";
    }

    function renderEngines(lines){
      // Expect array of strings; map each to a card with a logo if recognized
      const map = [
        { id:'ChatGPT',  logo:'/img/gpt.jpeg'    },
        { id:'Claude',   logo:'/img/claude.jpeg' },
        { id:'Gemini',   logo:'/img/gemini.jpeg' },
        { id:'Perplexity', logo:'/img/gemini.jpeg' }, // reuse if no icon provided
        { id:'Copilot',  logo:'/img/copilot.jpeg'}
      ];
      const findLogo = (text)=>{
        const m = map.find(m=> new RegExp(m.id,'i').test(text||""));
        return m ? m.logo : '/img/gpt.jpeg';
      };
      enginesEl.innerHTML = "";
      (lines||[]).forEach(line=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.style.marginBottom = '12px';
        card.innerHTML = `
          <div style="display:flex;gap:12px;align-items:center">
            <img src="${findLogo(line)}" alt="" style="width:24px;height:24px;border-radius:6px;object-fit:cover">
            <div>${escapeHTML(line)}</div>
          </div>
        `;
        enginesEl.appendChild(card);
      });
    }

    function escapeHTML(s){ return (s||"").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    async function loadReport(){
      if(!targetUrl){
        setNotice("No URL provided.");
        return;
      }
      try{
        showOverlay(); setProgress(8);

        // Build endpoint
        const endpoint = `${API_BASE}/api/full?url=${encodeURIComponent(targetUrl)}`;
        // Simulated staged progress
        setProgress(35);
        const res = await fetch(endpoint);
        setProgress(65);
        const data = await res.json();
        setProgress(90);

        // Fallback / notice
        if(!data || data.error){
          setNotice("Error: comprehensive AI report unavailable. Showing Lite analysis.");
        }
        if(data && data.success !== true){
          setNotice("âš ï¸ Showing Lite analysis (temporary). The comprehensive AI report service was unavailable.");
        }

        // Score & pillars
        const score = Number(data?.score ?? 50);
        scoreEl.textContent = `${score}/100`;
        derivePillars(score);

        // Lists
        renderBullets(data?.needsAttention || [], needsEl);
        renderBullets(data?.whatsWorking || [], workEl);
        renderEngines(data?.engineInsights || []);

        // Copy summary
        document.getElementById("copyBtn").onclick = async () => {
          const lines = [
            `Comprehensive AI SEO Analysis`,
            `Website: ${targetUrl}`,
            `Overall Score: ${score}/100`,
            ``,
            `Top Opportunities:`,
            ...(data?.needsAttention || []).slice(0,10).map(x => `- ${typeof x === 'string' ? x : x.issue}`),
            ``,
            `AI Engine Insights:`,
            ...(data?.engineInsights || []).map(x => `- ${x}`),
            ``,
            `Generated by SnipeRank`
          ].join("\n");
          try{ await navigator.clipboard.writeText(lines);
               const b = document.getElementById("copyBtn"); const old=b.textContent; b.textContent="Copied!"; setTimeout(()=>b.textContent=old,1500);
          }catch{ window.prompt("Copy the summary:", lines); }
        };

      }catch(err){
        console.error(err);
        setNotice("Error loading comprehensive analysis. Showing Lite suggestions.");
      }finally{
        setProgress(100); setTimeout(hideOverlay, 250);
      }
    }

    loadReport();
  </script>
</body>
</html>
