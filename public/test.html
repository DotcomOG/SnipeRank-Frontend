<!--
  SnipeRank - AI SEO Analysis Results Page (New Formspree Integration)
  Version: 1.9.0
  Last Updated: July 29, 2025
  Changes: hoping this is a working version!
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SnipeRank ‚Äî AI SEO Analysis Results</title>
  <style>
    :root {
      --max-width: 760px;
      --pad-v: 3vh;
      --pad-h: 2rem;
    }

    body {
      font-family: Helvetica, sans-serif;
      background: #fff;
      color: #000;
      margin: 0;
      padding: var(--pad-v) var(--pad-h);
      max-width: var(--max-width);
      margin-left: auto;
      margin-right: auto;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    h1 {
      font-size: 4rem;
      font-weight: 700;
      margin: 0 0 0.25em 0;
      line-height: 1;
      letter-spacing: -1px;
    }

    h2 {
      font-size: 1.5rem;
      font-weight: 400;
      margin: 0 0 2rem 0;
    }

    h3 {
      font-size: 1.2rem;
      font-weight: 500;
      margin: 2rem 0 1rem 0;
    }

    p {
      font-size: 1.1rem;
      line-height: 1.75;
      margin-bottom: 1rem;
    }

    #analyzed-url {
      text-align: center;
      margin-bottom: 1rem;
      color: #666;
    }

    #current-url {
      color: #000;
      font-weight: 500;
    }

    #summary-results {
      width: 100%;
      margin: 2rem 0;
      padding: 0;
      background: none;
      border: none;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 3rem 0 1.5rem 0;
      color: #000;
      letter-spacing: -0.5px;
      border-bottom: 3px solid #E53E3E;
      padding-bottom: 0.75rem;
      position: relative;
    }

    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: -0.5rem;
      width: 4rem;
      height: 3px;
      background: linear-gradient(90deg, #3182CE 0%, #E53E3E 50%, #F56500 100%);
    }

    /* Paul Rand inspired design elements */
    .insights-marker {
      display: inline-block;
      width: 4px;
      height: 1.2rem;
      background: linear-gradient(45deg, #3182CE 0%, #2B6CB0 100%);
      margin-right: 0.75rem;
      vertical-align: text-top;
      margin-top: 0.1rem;
      border-radius: 2px;
    }

    .opportunity-marker {
      display: inline-block;
      width: 0;
      height: 0;
      border-left: 8px solid #E53E3E;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
      margin-right: 0.75rem;
      margin-top: 0.3rem;
      vertical-align: text-top;
    }

    .strength-marker {
      display: inline-block;
      width: 10px;
      height: 10px;
      background: linear-gradient(45deg, #38A169 0%, #2F855A 100%);
      border-radius: 50%;
      margin-right: 0.75rem;
      margin-top: 0.35rem;
      vertical-align: text-top;
      box-shadow: 0 1px 3px rgba(56, 161, 105, 0.3);
    }

    /* Additional Paul Rand color accents */
    h1 {
      font-size: 4rem;
      font-weight: 700;
      margin: 0 0 0.25em 0;
      line-height: 1;
      letter-spacing: -1px;
      background: linear-gradient(135deg, #000 0%, #3182CE 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .form-button-wrapper button {
      background: linear-gradient(135deg, #E53E3E 0%, #C53030 100%);
      transition: all 0.3s ease;
    }

    .form-button-wrapper button:hover {
      background: linear-gradient(135deg, #C53030 0%, #9C2A2A 100%);
      transform: translateY(-1px);
    }

    ul {
      margin: 0 0 2rem 0;
      padding-left: 0;
      list-style: none;
    }

    li {
      margin-bottom: 1.5rem;
      line-height: 1.75;
      padding-left: 0;
      font-size: 1.1rem;
    }

    li strong {
      font-weight: 600;
      color: #000;
    }

    .new-analysis-section {
      text-align: center;
      margin: 2rem 0;
      padding: 1rem;
      border-top: 1px solid #ddd;
      width: 100%;
    }

    .new-analysis-form {
      display: flex;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    .new-analysis-form input {
      flex: 1;
      max-width: 400px;
      min-width: 250px;
    }

    .consultation-section {
      width: 100%;
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 3px solid #E53E3E;
      text-align: center;
    }

    .consultation-cta {
      margin: 2rem 0;
    }

    .schedule-button {
      display: inline-block;
      background: linear-gradient(135deg, #E53E3E 0%, #C53030 100%);
      color: white;
      padding: 1rem 2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(229, 62, 62, 0.3);
    }

    .schedule-button:hover {
      background: linear-gradient(135deg, #C53030 0%, #9C2A2A 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(229, 62, 62, 0.4);
    }

    .consultation-note {
      margin-top: 1.5rem;
      font-size: 0.95rem;
      color: #666;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }

    input, textarea {
      font-size: 1.05rem;
      padding: 0.8rem 1rem;
      border: 1px solid #000;
      width: 100%;
      background: transparent;
      box-sizing: border-box;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    button {
      font-size: 1rem;
      font-weight: 500;
      padding: 0.8rem 1.5rem;
      border: none;
      color: #fff;
      background: #000;
      cursor: pointer;
      margin-top: 1rem;
    }

    button:hover {
      background: #333;
    }

    .form-button-wrapper {
      text-align: center;
      margin-top: 1.5rem;
    }

    #formMessage {
      text-align: center;
      margin-top: 1rem;
      font-weight: 500;
    }

    .footer {
      font-size: 0.85rem;
      color: #666;
      margin-top: 3rem;
      text-align: center;
      width: 100%;
    }

    /* Logo styling for enhanced content */
    .engine-logo {
      width: 18px;
      height: 18px;
      margin-right: 0.5rem;
      vertical-align: text-top;
      display: inline-block;
    }

    @media (max-width: 600px) {
      .new-analysis-form {
        flex-direction: column;
      }
      
      .new-analysis-form input {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>SnipeRank</h1>
  <h2>AI SEO Analysis Results</h2>
  <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">Powered by <a href="https://quontora.com" target="_blank" style="color: #3182CE; text-decoration: none; font-weight: 500;">Quontora</a></p>

  <div id="analyzed-url" style="margin-bottom: 0.5rem;">
    <p style="margin: 0; font-size: 1rem;">Analysis for: <strong id="current-url"></strong></p>
  </div>

  <!-- ALL CONTENT BELOW IS DYNAMIC FROM YOUR BACKEND API -->
  <section id="summary-results">
    <p style="text-align: center; color: gray;">Loading analysis...</p>
  </section>

  <section class="new-analysis-section">
    <h3>Analyze Another Website</h3>
    <form id="newAnalysisForm" class="new-analysis-form">
      <input type="text" id="newUrl" placeholder="Enter another URL..." required />
      <button type="submit">Analyze</button>
    </form>
  </section>

  <section class="consultation-section">
    <h3>Ready to Improve Your AI Visibility?</h3>
    <p>After reviewing your analysis, book a free 30-minute consultation to discuss your specific opportunities and next steps.</p>
    
    <div class="consultation-cta">
      <a href="#" id="scheduleBtn" class="schedule-button" target="_blank">
        Schedule Free Consultation
      </a>
    </div>
    
    <p class="consultation-note">
      <strong>What we'll cover:</strong> Your AI SEO opportunities, implementation timeline, and how to get found by ChatGPT, Gemini, and other AI platforms.
    </p>
  </section>

  <div class="footer">&copy; 2025 SnipeRank by <a href="https://quontora.com" target="_blank" style="color: #3182CE; text-decoration: none;">Quontora</a>. Last updated July 26.</div>

  <script>

    // Test API connection
console.log("Testing API connection...");
fetch('/api/friendly?url=https://example.com')
  .then(res => res.json())
  .then(data => console.log("API test successful:", data))
  .catch(err => console.error("API test failed:", err));

    
    // Load short report
    document.addEventListener("DOMContentLoaded", async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const targetUrl = urlParams.get("url") || "https://example.com"; // fallback for testing

      if (!targetUrl) {
        document.getElementById("summary-results").innerHTML =
          "<p style='color:red; text-align:center;'>No URL provided.</p>";
        return;
      }

      // Display the URL being analyzed and set hidden form field
      document.getElementById("current-url").textContent = targetUrl;
      document.getElementById("analyzedUrlField").value = targetUrl;

      const requestUrl = `/api/friendly?url=${encodeURIComponent(targetUrl)}`;

function formatDataAsHTML(data) {
  let html = '<div>';
  
  if (data.score) {
    html += `<p style="text-align: center; font-size: 1.2em; margin-bottom: 2rem;"><strong>Overall Score: ${data.score}/100</strong></p>`;
  }
  
  if (data.superpowers && data.superpowers.length > 0) {
    html += '<h3 class="section-title">AI Superpowers</h3><ul>';
    data.superpowers.forEach(item => {
      html += `<li><span class="strength-marker"></span>${item}</li>`;
    });
    html += '</ul>';
  }
  
  if (data.opportunities && data.opportunities.length > 0) {
    html += '<h3 class="section-title">SEO Opportunities</h3><ul>';
    data.opportunities.forEach(item => {
      html += `<li><span class="opportunity-marker"></span>${item}</li>`;
    });
    html += '</ul>';
  }
  
  if (data.insights && data.insights.length > 0) {
    html += '<h3 class="section-title">AI Engine Insights</h3><ul>';
    data.insights.forEach(item => {
      html += `<li><span class="insights-marker"></span>${item}</li>`;
    });
    html += '</ul>';
  }
  
  html += '</div>';
  return html;
}
  
    });

    // Enhance existing AI insights with logos and replace emojis
    function enhanceExistingAIInsights() {
      try {
        // Find existing content
        const summaryDiv = document.getElementById("summary-results");
        let summaryHTML = summaryDiv.innerHTML;
        
        // Replace checkmark emojis (‚úÖ) with nothing (remove green circles)
        summaryHTML = summaryHTML.replace(/‚úÖ/g, '');
        summaryHTML = summaryHTML.replace(/üö®/g, '<span class="opportunity-marker"></span>');
        summaryHTML = summaryHTML.replace(/ü§ñ/g, '<span class="insights-marker"></span>');
        
        // Remove any other emojis
        summaryHTML = summaryHTML.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');
        
        // Add AI engine logos
        summaryHTML = summaryHTML.replace(
          /ChatGPT Perspective:/g,
          `<svg class="engine-logo" viewBox="0 0 24 24"><path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" fill="#74AA9C"/></svg>ChatGPT Perspective:`
        );
        
        summaryHTML = summaryHTML.replace(
          /(Google Bard Analysis:|Gemini:)/g,
          `<svg class="engine-logo" viewBox="0 0 24 24"><defs><linearGradient id="geminiGrad3" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#4285F4"/><stop offset="25%" style="stop-color:#34A853"/><stop offset="50%" style="stop-color:#FBBC04"/><stop offset="75%" style="stop-color:#EA4335"/><stop offset="100%" style="stop-color:#4285F4"/></linearGradient></defs><polygon points="12,2 22,8 22,16 12,22 2,16 2,8" fill="url(#geminiGrad3)"/><circle cx="12" cy="12" r="3" fill="white"/></svg>Gemini:`
        );
        
        summaryHTML = summaryHTML.replace(
          /(Copilot|Microsoft Copilot):/g,
          `<svg class="engine-logo" viewBox="0 0 24 24"><path d="M1.8 12a10.2 10.2 0 1 1 20.4 0 10.2 10.2 0 0 1-20.4 0z" fill="#0078d4"/><path d="M8.4 9.6h7.2v1.2H8.4zm0 2.4h7.2v1.2H8.4zm0 2.4h4.8v1.2H8.4z" fill="#fff"/><circle cx="18" cy="15" r="1.5" fill="#FFB900"/></svg>Copilot:`
        );
        
        summaryHTML = summaryHTML.replace(
          /(Perplexity Assessment:|Perplexity:)/g,
          `<svg class="engine-logo" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11" fill="#20808D"/><path d="M8 8l8 8M16 8l-8 8" stroke="white" stroke-width="1.5" stroke-linecap="round"/><circle cx="12" cy="12" r="2" fill="white"/></svg>Perplexity Assessment:`
        );
        
        summaryHTML = summaryHTML.replace(
          /Claude:/g,
          `<svg class="engine-logo" viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 2.4c5.302 0 9.6 4.298 9.6 9.6s-4.298 9.6-9.6 9.6S2.4 17.302 2.4 12 6.698 2.4 12 2.4zm0 3.6a6 6 0 1 0 0 12 6 6 0 0 0 0-12zm0 1.8a4.2 4.2 0 1 1 0 8.4 4.2 4.2 0 0 1 0-8.4z" fill="#CC785C"/></svg>Claude:`
        );
        
        // Update the content
        summaryDiv.innerHTML = summaryHTML;
        
        console.log("Enhancement completed successfully");
      } catch (error) {
        console.error("Error in enhanceExistingAIInsights:", error);
      }
    }

    // Handle new URL analysis
    document.getElementById("newAnalysisForm").addEventListener("submit", function (e) {
      e.preventDefault();
      let url = document.getElementById("newUrl").value.trim();
      
      if (!url) return;
      
      if (!/^https?:\/\//i.test(url)) {
        url = "https://" + url;
      }
      
      window.location.href = `test.html?url=${encodeURIComponent(url)}`;
    });

    // Form submission - check if form exists first
    const fullReportForm = document.getElementById("fullReportForm");
    if (fullReportForm) {
      fullReportForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        
        const formMessage = document.getElementById("formMessage");
        const submitButton = this.querySelector('button[type="submit"]');
        
        // Show loading state
        submitButton.textContent = "Sending...";
        submitButton.disabled = true;
        
        try {
          const formData = new FormData(this);
          const response = await fetch(this.action, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          });
          
          if (response.ok) {
            formMessage.innerHTML = "‚úÖ Success! Your full AI SEO analysis will be emailed to you within 24 hours.";
            formMessage.style.color = "#38A169";
            this.reset();
            // Reset the analyzed URL field
            const analyzedUrlField = document.getElementById("analyzedUrlField");
            if (analyzedUrlField) {
              analyzedUrlField.value = document.getElementById("current-url").textContent;
            }
          } else {
            throw new Error('Form submission failed');
          }
        } catch (error) {
          formMessage.innerHTML = "‚ùå Something went wrong. Please try again or email us directly.";
          formMessage.style.color = "#E53E3E";
        } finally {
          submitButton.textContent = "Email My Full Report";
          submitButton.disabled = false;
        }
      });
    }
  </script>
</body>
</html>
